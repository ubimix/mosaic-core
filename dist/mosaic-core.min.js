/* 
 * mosaic-core v0.0.13 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("mosaic-commons"),require("underscore"),require("mosaic-teleport"),require("react"),require("leaflet")):"function"==typeof define&&define.amd?define(["mosaic-commons","underscore","mosaic-teleport","react","leaflet"],b):"object"==typeof exports?exports["mosaic-core"]=b(require("mosaic-commons"),require("underscore"),require("mosaic-teleport"),require("react"),require("leaflet")):a["mosaic-core"]=b(a["mosaic-commons"],a.underscore,a["mosaic-teleport"],a.react,a.leaflet)}(this,function(a,b,c,d,e){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1);d.App=c(2),d.App.Actions=c(3),d.App.Api=c(4),d.App.Component=c(5),d.App.Store=c(6),d.React={FilterBox:c(7),SearchBoxMixin:c(8)},d.Leaflet={ReactMap:c(9),FeatureBuilder:c(10),UtfGrid:c(11),MapViewport:c(12)},d.Core={DataSet:c(13),ActivationTree:c(14),InfiniteScroll:c(15),AbstractSet:c(16),AdapterManager:c(17),CompositeDataSet:c(18),DataSetView:c(19),Dependencies:c(20),Intents:c(21),LeafletDataSetView:c(22),LeafletDataSubsetView:c(23),LeafletFeatureBuilder:c(10),ReactDataSetMixin:c(24),ViewManager:c(25),URI:c(26)},a.exports=d},function(b){b.exports=a},function(a,b,c){var d=c(1),e=c(21);a.exports=d.Class.extend(d.Events.prototype,{initialize:function(a){this.setOptions(a),this.intents=new e,this.initModules()},start:function(){var a=this;return d.P.then(function(){return a.preloadData()}).then(function(){return a.initViews()},function(b){return a.initViews(b)})},stop:function(){var a=this;return d.P.then(function(){return a.deleteViews()}).then(function(){return a.deleteModules()})},preloadData:function(){},initModules:function(){},deleteModules:function(){},initViews:function(){},deleteViews:function(){}})},function(a,b,c){var d=(c(27),c(5));a.exports=d.extend({})},function(a,b,c){function d(a){return a?e.isArray(a)?a:e.isArray(a.features)?a.features:a:a}var e=c(27),f=c(5),g=c(1),h=c(28),i=f.extend({initialize:function(a){this.setOptions(a),this.app=this.options.app,this._initFields(),this.api=this._initApi(this.options.key)},notify:function(){this.emit("changed")},addChangeListener:function(a,b){this.on("changed",a,b)},removeChangeListener:function(a,b){this.off("changed",a,b)},_initFields:function(){},_initApi:function(a){var b=this._getIntents(),c=this._getApiMethods();return this.api=b.initApi(a,this,c),this.api},_getApiMethods:function(){var a={};return e.each(e.functions(this),function(b){"_"!=b[0]&&(b.match(/^on.+$/)||(a[b]=!0))}),e.each(e.functions(f.prototype),function(b){delete a[b]},this),e.keys(a).sort()},_getIntents:function(){var a=this.intents||this.options.intents;return!a&&this.app&&(a=this.app.intents),a},_loadAndMergeGeoJsonArrays:function(a){var b=this;return a=e.isString(a)?[a]:e.toArray(a),g.P.all(e.map(a,function(a){return b._loadGeoJsonArray(a)})).then(function(a){var b=[];return e.each(a,function(a){b=b.concat(a)}),b})},_getGeoJsonArray:function(a){return this._getJson(a).then(d)},_loadGeoJsonArray:function(a){var b=e.isString(a)?a:a.path;return this._loadJson(b).then(d)},_getJson:function(a){var b=this;return g.P.then(function(){var c,d=a.path,e=a.noCache,f=a.force,g=b._cache=b._cache||{};return e||f||(c=g[d]),c?c:b._loadJson(d).then(function(a){return e||(g[d]=a),a})})},_loadJson:function(a){var b=this;return g.P.then(function(){var c=b.app.options.baseUrl,d=h.HttpClient.newInstance({baseUrl:c});return d.exec({path:a,method:"GET"})})}});i.intent=function(a){return a.intentHandler=!0,a},i.toArray=d,a.exports=i},function(a,b,c){var d=c(1);a.exports=d.Class.extend(d.Events.prototype,{initialize:function(a){this.setOptions(a),this.app=this.options.app}})},function(a,b,c){var d=c(27),e=c(5);a.exports=e.extend({setOptions:function(){e.prototype.setOptions.apply(this,arguments),this.options.app&&(this.app=this.options.app)},_addActions:function(a){var b=this;b.actions||(b.actions={}),d.each(a,function(a){b.actions[a]=function(c){return b.app.intents.newIntent(a,c).promise}})},initialize:function(a){this.setOptions(a),this._initFields()},notify:function(){this.emit("changed")},addChangeListener:function(a,b){this.on("changed",a,b)},removeChangeListener:function(a,b){this.off("changed",a,b)},_initFields:function(){}})},function(a,b,c){var d=c(27),e=c(1),f=c(29),g=e.Class.extend(e.Events.prototype,{initialize:function(a){this.values=[],d.extend(this,a)},set:function(a){return d.isArray(a)||(a=[]),this.values=a,this._notify("set"),this},getAll:function(){return this.values},add:function(a){return this.values.push(this.newFilterValue(a)),this._notify("add"),this},remove:function(a){var b=this.values.length;return this.values=d.filter(this.values,function(b){return b!=a}),this.values.length!=b&&this._notify("remove"),this},newFilterValue:function(a){return{label:a}},setFocused:function(a,b){var c=!1;this._focused!==a&&(c=!0,this._focused=a,b||this.emit("focus",this._focused))},isFocused:function(){return!!this._focused},_notify:function(a){return a&&this.emit(a),this.emit("changed"),this},addChangeListener:function(a,b){return this.on("changed",a,b),this},removeChangeListener:function(a,b){return this.off("changed",a,b),this}});a.exports=f.createClass({displayName:"React.FilterBox",statics:{Model:g,extendModel:function(a){return g.extend(a)}},getInitialState:function(){return this._newState({})},componentWillMount:function(){this.props.model.addChangeListener(this._notifyUpdates)},componentWillUnmount:function(){this.props.model.removeChangeListener(this._notifyUpdates)},componentDidMount:function(){this.componentDidUpdate()},componentDidUpdate:function(){if(this.props.model.isFocused()){var a=this.refs.input,b=a.getDOMNode();b.focus()}},_notifyUpdates:function(){this.setState(this._newState({text:""})),this.props.model.setFocused(!0)},_newState:function(a){var b=this.props.model;return d.extend({text:"",values:b.getAll()},this.state,a)},_addValue:function(a){a&&""!==a&&this.props.model.add(a)},_removeLastValue:function(){var a=this.props.model,b=a.getAll();b&&b.length&&a.remove(b[b.length-1])},_focusInput:function(){this.props.model.setFocused(!0),this.forceUpdate()},_handleInputFocus:function(){this.props.model.setFocused(!0)},_handleInputBlur:function(){this._addValue(this.state.text),this.props.model.setFocused(!1,!0)},_handleInputChange:function(){var a=this.refs.input.getDOMNode(),b=a.value,c=this._getInputSize(b);a.size=c,this.setState(this._newState({text:b}))},_handleKeyDown:function(a){var b=!1;9===a.which?(this._addValue(this.state.text),this.props.model.setFocused(!0),b=!0):8===a.which&&""===this.state.text?(this._removeLastValue(),b=!0):13===a.which?(this._addValue(this.state.text),this.props.onSubmit&&this.props.onSubmit(a),b=!0):27==a.which&&(b=!0),b&&(this.setState(this._newState({text:""})),a.preventDefault(),a.stopPropagation())},_handleItemClick:function(a,b){this.props.model.remove(a),b.preventDefault(),b.stopPropagation()},_formatTags:function(){var a=this.props.model;return d.map(a.getAll(),function(a){if(d.isFunction(a.format))return a.format();var b="item tag";return a.className&&(b+=" "+a.className),f.DOM.a({key:d.uniqueId("id-"),href:"#",className:b,onClick:this._handleItemClick.bind(this,a)},a.label,f.DOM.span({key:d.uniqueId("id-"),className:"cross",onClick:this._handleItemClick.bind(this,a)}))},this)},render:function(){var a=(this.props.app,this.props.className||"filter-box");this.props.model.isFocused()&&(a+=" focused");var b=this.state.text,c=this._getInputSize(b);return f.DOM.div(d.extend({},this.props.options,{onClick:this._focusInput,className:a}),this._formatTags(),f.DOM.input(d.extend({className:"item"},this.props.inputOptions,{ref:"input",size:c,type:"text",onFocus:this._handleInputFocus,onBlur:this._handleInputBlur,onChange:this._handleInputChange,onKeyDown:this._handleKeyDown,value:b})))},_getInputSize:function(a){return a=a||"",Math.min(50,Math.max(a.length,3))}})},function(a,b,c){var d=c(27),e=c(29),f=(c(1),c(7)),g=f.extendModel({_convertSearchToFilters:function(a){var b=[];return d.map(a,function(a,c){d.isArray(a)?d.each(a,function(a){b.push(this.newFilterValue(a,c))},this):b.push(this.newFilterValue(a,c))},this),b},convertFiltersToSearch:function(a){var b={};return d.each(a,function(a){var c=a.key,e=this.newSearchValue(a,c);if(d.has(b,c)){var f=b[c];f.push(e)}else b[c]=[e]},this),b},newFilterValue:function(a,b){return{key:b||this.getDefaultField(),label:a}},newSearchValue:function(a){return a.label},getDefaultField:function(){return this.textSearchField||"q"}}),h={Model:g,componentWillMount:function(){var a=this._getFilterBoxModel();a.on("add",this._onFilterBoxChanged,this),a.on("remove",this._onFilterBoxChanged,this)},componentDidUnmount:function(){var a=this._getFilterBoxModel();a.off("add",this._onFilterBoxChanged,this),a.off("remove",this._onFilterBoxChanged,this),delete this._model},_convertSearchToFilters:function(a){var b=this._getFilterBoxModel();return b._convertSearchToFilters(a)},_convertFiltersToSearch:function(a){var b=this._getFilterBoxModel();return b.convertFiltersToSearch(a)},_getFilterBoxModel:function(){var a=this;return a._model||(a._model=d.isFunction(a._newFilterModel)?a._newFilterModel():new g),a._model},_onFilterBoxChanged:function(){var a=this.getSearchCriteria();this._onSearchCriteriaChanged(a)},setSearchCriteria:function(a){var b=this._getFilterBoxModel(),c=this._convertSearchToFilters(a);b.set(c)},getSearchCriteria:function(){var a=this._getFilterBoxModel(),b=a.getAll(),c=this._convertFiltersToSearch(b);return c},renderSearchBox:function(a){var b=e.createFactory(f);return b(d.extend({},a,{model:this._getFilterBoxModel()}))}};a.exports=h},function(a,b,c){var d=c(27),e=c(29),f=c(30);a.exports=e.createClass({displayName:"ReactMap",render:function(){return e.DOM.div({ref:"container",id:this.props.id,className:this.props.className})},componentDidMount:function(){var a=this.refs.container.getDOMNode();this.map=this._newMap(a),this.map.on("zoomend",this._updateZoomStyles,this),this.props.onMapAdd&&this.props.onMapAdd(this.map),this._updateZoomStyles()},componentWillUnmount:function(){this.props.onMapRemove&&this.props.onMapRemove(this.map),this.map.off("zoomend",this._updateZoomStyles,this),this.map.remove(),delete this.map},_newMap:function(a){var b=this.props.options||{},c=d.extend({},b,{zoomControl:!1,attributionControl:!1}),e=f.map(a,c);if(c=d.extend({},b.zoomControl),c=d.defaults(c,{position:"topright"}),b.zoomControl!==!1){var g=f.control.zoom(c);e.addControl(g)}if(b.attributionControl!==!1){var h=f.control.attribution(c);e.addControl(h)}var i=b.center;d.isArray(i)&&(i=f.latLng(i[1],i[0]));var j=b.zoom;return i&&void 0!==j&&e.setView(i,j),e},_updateZoomStyles:function(){for(var a=this.getDOMNode(),b=this.map.getZoom(),c=[],d=0;b>=d;d++)c.push("zoom-"+d);var e=a.className;e=e.replace(/zoom-\d+\s*/gim,""),e+=" "+c.join(" "),a.className=e}})},function(a,b,c){var d=c(30),e=c(1),f=e.Class.extend({initialize:function(a,b){b||(b=a,a=null),this.data=a,_.extend(this,b);var c=["onClick","onMouseOver","onMouseOut","onDblClick","onMouseMove"];this._handlers={},_.each(c,function(a){var b=a.toLowerCase().substring(2);this[a]=function(a){return void 0!==a?(this._handlers[b]=a,this):this._handlers[b]}},this)},setEventBinder:function(a){return this.bindEventHandlers=a,this},bindEventHandlers:function(a,b){var c=this;_.each(c._handlers,function(c,d){b.on(d,function(b){c(a,b)})})},setOptions:function(a){return this.opt=a,this},getOptions:function(){var a=_.toArray(arguments);return this._getOrInvoke(this.opt,a)||{}},setMarker:function(a){return this._marker=a,this},getMarker:function(){var a=_.toArray(arguments);return this._getOrInvoke(this._marker,a)},build:function(a){var b=this;a=a||b.data;var c=a.geometry;if(b._isEmptyGeometry(c))return null;var e,f=b.getOptions(a),g=d.GeoJSON.geometryToLayer(a,function(a,c){return e=b.getMarker(a,f),void 0===e&&(e=new d.Marker(c,f)),e},d.GeoJSON.coordsToLatLng,f);return g&&!e&&(e=b.getMarker(a,f),e&&(g=d.featureGroup([g,e]))),this.bindEventHandlers(a,g),g},_getOrInvoke:function(a,b){return _.isFunction(a)?a.apply(a,b):a},_isEmptyGeometry:function(a){return a&&a.coordinates&&a.coordinates.length&&("Point"!=a.type||a.coordinates[0]&&a.coordinates[1])?!1:!0}}),g=function(a,b){return new f(a,b)};a.exports=g},function(a,b,c){var d=c(27),e=(c(30),c(31)),f=e.extend({initialize:function(a){var b=e.prototype;b.initialize.call(this,a),d.defaults(this.options,{resolution:4,pointerCursor:!0}),this._loader=this.options.loader||new MapTilesLoader(this.options)},_objectForEvent:function(a){var b,c=this._map,d=c.getZoom(),e=c.project(a.latlng),f=this._getTilePosition(e),g=this._loader.getTile(d,f);return g&&(b=this._getTileObject(g,e)),{latlng:a.latlng,data:b}},_getTileObject:function(a,b){var c=this._getTileShift(b.x),d=this._getTileShift(b.y),e=this._utfDecode(a.grid[d].charCodeAt(c)),f=a.keys[e],g=this._processData(a.data[f]);return g},getTileObjects:function(a){return a&&a.data?d.map(d.values(a.data),this._processData,this):[]},_processData:function(a){return a?(this._processDataF||(this._processDataF=this.options.processData||function(a){return a}),this._processDataF(a)):a},_getTileShift:function(a){var b=this.options.tileSize,c=this.options.resolution;return Math.floor((a-Math.floor(a/b)*b)/c)},_utfDecode:function(a){return a>=93&&a--,a>=35&&a--,a-32}});a.exports=f},function(a,b,c){var d=c(30),e=d.Class.extend({initialize:function(a){d.setOptions(this,a);var b=this.options.viewport;b&&this.setViewport(b),this.options.focus&&this.setFocusPosition(this.options.focus)},getMap:function(){return this.options.map},setViewport:function(a){this._viewport=d.bounds(a),this._focusPos||(this._focusPos=this._viewport.getCenter())},getViewport:function(){if(this._viewport)return this._viewport;var a=this.getMap();return d.bounds([0,0],a.getSize())},setFocusPosition:function(a){this._focusPos=d.point(a.left,a.top)},focusTo:function(a,b,c){"function"==typeof b&&(c=b,b=null),c=this._checkCallback(c);var d=this.getMap();if(b=b||this._focusPos,d.once("moveend",c),b){var e=d._getTopLeftPoint();e._add(b);var f=d.project(a).subtract(e);d.panBy(f)}else d.panTo(a)},zoomTo:function(a,b){var c=this.getMap();b=this._checkCallback(b),c.getZoom()==a?b():(c.once("zoomend",b),c.setZoom(a))},panInsideBounds:function(a,b){var c=this,d=c.getMap();b=c._checkCallback(b);var e=c._getViewportPadding(),f=d.getBoundsZoom(a,!0,e);c.zoomTo(f,function(){var e=c._focusPos,g=d._limitCenter(e,f,a);center.equals(g)?b():c.focusTo(g,b)})},fitBounds:function(a){var b=(this.getViewport(),this._getViewportPadding()),c={};c.paddingTopLeft=b.min,c.paddingBottomRight=b.max;var d=this.getMap();d.fitBounds(a,c)},_checkCallback:function(a){return a||function(){}},_getViewportPadding:function(){var a=this.getViewport(),b=a.min,c=this.getMap(),e=c.getSize(),f=e.subtract(a.max);return d.bounds(b,f)}});a.exports=e},function(a,b,c){var d=(c(1),c(16)),e=c(27),f=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),this._open=!1},open:function(){return this._open?!1:(this.triggerMethod("open"),this.options.data&&this.setData(this.options.data),this._open=!0,!0)},close:function(){return this._open?(this.setData([]),this.triggerMethod("close"),this._open=!1,!0):!1},setData:function(a){this.triggerMethod("update:begin");var b=this._setObjects(a);return this.triggerMethod("update",b),this.triggerMethod("update:end"),this},getData:function(a){if(a){var b=this._index[a];return b?b.obj:null}return e.map(this._index,function(a){return a.obj})},getDataEntries:function(a){if(a){var b=this._index[a];return b}return e.values(this._index)},getDataIndex:function(a){var b=this.getKey(a);return this.getIndex(b)}});a.exports=f},function(a,b,c){var d=c(1),e=c(27),f=d.Class.extend(d.Events.prototype,d.Events,{initialize:function(a){this.setOptions(a),this._children={}},getPath:function(a){for(var b="",c=this;c&&c!=a;)b="/"+c.getKey()+b,c=c.getParent();return b},getParent:function(){return this.parent},getKey:function(){return this.options.key},add:function(a,b){var c=this;return!b&&e.isObject(a)&&(b=a),e.isFunction(a.getKey)&&(a=a.getKey()),c.remove(a),b||(b=c._newChild(a)),b.parent=this,c._children[a]=b,b._notify("add",{}),b},get:function(a,b){var c=this._children[a];if(!c){var d=a.split("/");c=this._getByPath(d,0,b)}return c},getAll:function(){var a=this,b=e.toArray(arguments),c=[];return a._forEach(b,function(a){c.push(a)}),c},getAllKeys:function(){var a=this;return e.keys(a._children)},isParentOf:function(a,b){for(var c=b!==!1?a:a.getParent(),d=!1;c&&!(d=c===this);)c=c.getParent();return d},find:function(a){var b,c=this,d=c.getKey();return a==d?b=c:c._forEach([],function(c){return b=c.find(a),!b}),b},remove:function(a){var b=this,c=b._children[a];return c&&(c._notify("remove",{}),delete b._children[a]),c},visit:function(a){var b=this,c=!0;e.isFunction(a.before)&&(c=a.before(b)!==!1),c&&e.each(b._children,function(b){b.visit(a)}),e.isFunction(a.after)&&a.after(b)},_getByPath:function(a,b,c){var d=b>=0&&b<a.length?a[b]:null;if(d){var e=this._children[d];return!e&&c&&(e=this.add(d)),e&&b<a.length-1?e._getByPath(a,b+1,c):e}},_forEach:function(a,b){function c(a){var c=!1;if(a){var e=b.call(f,a,d);c=e===!1}return d++,c}var d=0,f=this;e.isFunction(a)&&(b=a,a=[]),a&&a.length?e.find(a,function(a){var b=f._children[a];return c(b)}):e.find(f._children,c)},_notify:function(a,b){var c=this;for(b.node=c;c&&(c.triggerMethod(a,b),!b.stopPropagation);)c=c.getParent()},_newChild:function(a){var b=this.getClass();return new b(e.extend({},this.options,{key:a}))}}),g={_status:"inactive",getStatus:function(){return this._status||""},setStatus:function(a,b){var c=this._status,d=c!=a||b&&b.force;return d&&(this._status=a,this._notify("status",e.extend({},b,{prevStatus:c}))),d},setExclusive:function(a){this.options.exclusive=!!a},isExclusive:function(){return"exclusive"==this.options.mode||this.options.exclusive!==!1},isActive:function(){return"active"==this._status},activate:function(a){return this.setStatus("active",a)},deactivate:function(a){return this.setStatus("inactive",a)},toggle:function(a){return this.isActive()?this.deactivate(a):this.activate(a)},getActive:function(){var a=this.getAll();return e.map(a,function(a){return a.isActive()})},getFirstActive:function(){var a=this.getAll();return e.find(a,function(a){return a.isActive()})},getStats:function(){var a=this,b={all:[]};return a._forEach([],function(a){var c=a.getKey();b.all.push(c);var d=a.getStatus(),e=b[d]=b[d]||[];e.push(c)}),b},onStatus:function(){function a(){return{internal:!0}}function b(b,c){"before"==c?b.activate(a()):"after"==c&&b.deactivate(a())}function c(b,c){"before"==c?b.deactivate(a()):"after"==c&&b.activate(a())}function d(b,c){("before"==c||"after"==c)&&b.deactivate(a())}function e(a,e){var f;if("activateBefore"==a.options.mode?f=b:"activateAfter"==a.options.mode?f=c:a.isExclusive()&&(f=d),f){var g="before",h=function(a){"before"==g&&a.isParentOf(e.node,!0)&&(g="in"),f(a,g),"in"==g&&(g="after")};a._forEach([],h)}}return function(b){var c=this;b.node!=c?b.node.isActive()&&!b.internal&&(e(c,b),c.activate()):!c.isActive()&&c.options.deactivateAll&&c.visit({after:function(b){b.deactivate(a())}})}}()},h=f.extend(g,{initialize:function(a){var b=f.prototype;b.initialize.call(this,a),this.setOptions({deactivateAll:!0})}});a.exports=h},function(a,b,c){var d=(c(1),c(27)),e=c(29);a.exports=e.createClass({render:function(){var a=this.state.items||[],b=this._getSize(),c=this._getItemHeight(),d=(this.state.index||0)*c,f=b*c;return e.DOM.div({id:this.props.id,className:this.props.className,style:this.props.style,onScroll:this._onScroll},e.DOM.div({ref:"wrapper",style:{height:f+"px",position:"relative"}},e.DOM.div({ref:"block",style:{top:d+"px",position:"absolute",left:"0px",right:"0px",bottom:"auto"}},a)))},componentWillMount:function(){this._adjustPosition=d.debounce(this._adjustPosition,5),this._setScrollPos=d.debounce(d.bind(this._setScrollPos,this),30)},componentDidMount:function(){this._resetScrollPos(this.props)},componentWillReceiveProps:function(a){this._resetScrollPos(a)},componentDidUpdate:function(){this._adjustPosition()},getInitialState:function(){return this._newState({index:0,length:0,items:[],scrollPos:0})},_newState:function(a){return d.extend({},this.state,a)},_getPageSize:function(){return this.props.pageSize||4},_getSize:function(){return this.props.length||0},_getItemHeight:function(){return this.props.itemHeight||10},_loadItems:function(a){this.props.loadItems(a)},_resetScrollPos:function(a){a=a||this.props;var b=this.state.scrollPos,c=a.focusedIndex;c=isNaN(c)?-1:c;var d=this._getSize();if(!isNaN(c)&&c>=0&&d>c){var e=this._getItemHeight();b=c*e}this._focusedItemIdx=c,this._resetPos=!0,this._setScrollPos(b,!0)},_adjustPosition:function(){if(this.isMounted()){var a=this,b=a.getDOMNode(),c=b.scrollTop,d=a._getItemHeight(),e=c-a.state.index*d,f=a.state.items.length*d,g=a.refs.block.getDOMNode(),h=g.offsetHeight,i=c-h*(e/f);i=Math.round(i),g.style.top=i+"px",isNaN(a._focusedItemIdx)||(delete a._focusedItemIdx,setTimeout(function(){b.scrollTop=a.state.scrollPos},30))}},_setScrollPos:function(a,b){var c=this;if(c.isMounted()){var d=c._getPageSize(),e=c._getItemHeight(),f=c.getDOMNode(),g=f.offsetHeight,h=g/4,i=Math.max(a-h,0),j=a+g+h,k=Math.floor(i/e),l=Math.ceil((j+e-1)/e),m=Math.floor(k/d),n=Math.ceil((l+d-1)/d),o=m*d,p=(n-m)*d,q={scrollPos:a,index:o,length:p};c._resetPos||b||q.index!=c.state.index||q.length!=c.state.length?(q.callback=function(a){q.items=a,c.isMounted()&&c.setState(c._newState(q))},c._loadItems(q),delete c._resetPos):c._adjustPosition()}},_onScroll:function(){this._setScrollPos(this.getDOMNode().scrollTop)}})},function(a,b,c){var d=c(1),e=c(27),f=d.Class.extend(d.Events.prototype,d.Events,{initialize:function(a){e.extend(this,a)}}),g=d.Class.extend(d.Events.prototype,d.Events,{initialize:function(a){this.setOptions(a),e.isFunction(this.options.getKey)&&(this.getKey=this.options.getKey),this._index={}},_setObjects:function(a){var b=this,c=e.toArray(a),d={},f={enter:{},update:{},exit:{}};return e.each(c,function(a,c){var g,h=b.getKey(a);e.has(b._index,h)?(g=b._onUpdate(b._index[h])||g,delete b._index[h],f.update[g.key]=g):(g=b._newSetEntry({key:h,obj:a,idx:c}),g=b._onEnter(g)||g,f.enter[g.key]=g),d[h]=g}),e.each(b._index,function(a){f.exit[a.key]=b._onExit(a)||a}),b._index=d,f},_newSetEntry:function(a){return new f(a)},_getIndexEntries:function(a){return a?e.isArray(a)?e.map(a,function(a){return this._index[a]},this):this._index[a]:e.values(this._index)},_getIndexEntry:function(a){return this._index[a]},getKey:function(a){return a},getKeys:function(){return e.keys(this._index)},_onEnter:function(a){return a.emit("enter"),a},_onExit:function(a){return a.emit("exit"),a},_onUpdate:function(a){return a.emit("update"),a},getIndex:function(a){var b=a?this._index[a]:null;return b?b.idx:-1},hasKey:function(a){return e.has(this._index,a)}});g.SetEntry=f,a.exports=g},function(a,b,c){var d=c(27),e=c(1),f=e.Class,g=f.extend({TYPE_KEY_DELIM:"/",initialize:function(){this._adapters={},this._cache={}},_getKey:function(a,b){var c=this.getTypeKey(a),d=this.getTypeKey(b);return c+"::"+d},registerAdapter:function(a,b,c){var d=this._getKey(a,b);this._adapters[d]=c,this._cache={}},getAdapter:function(a,b){var c=this,e=c._getKey(a,b),f=c._cache[e];return f||d.has(c._cache,e)||(d.find(c._expandId(a),function(a){return d.find(c._expandId(b),function(b){var d=c._getKey(a,b);return f=c._adapters[d],!!f}),!!f}),c._cache[e]=f),f},newAdapterInstance:function(a,b,c){var e=this.getAdapter(a,b),f=null;return d.isFunction(e)?(c=c||{},this._checkValidity(e,c)&&(d.isFunction(e.initialize)&&e.initialize(c),f=new e(c),this._checkValidity(f,c)||(f=null))):f=e,f},removeAdapter:function(a,b){var c=this._getKey(a,b),d=this._adapters[c];return delete this._adapters[c],delete this._cache[c],d},_checkValidity:function(a,b){if(!d.isFunction(a.isValid))return!0;var c=a.isValid(b);return c},_expandId:function(a){if(!a)return[];for(var b=[],c=!1;d.isFunction(a.getParent)&&(c=!0,a=a.getParent());)b.push(a);if(!c&&d.isString(a)){a=this._normalizeTypeKey(a);for(var e=this.TYPE_KEY_DELIM,f=a.split(e);f.length;){var g=f.join(e);b.push(g),f.pop()}b.push("")}return b},getTypeKey:function(a){var b;if(a)if(d.isString(a))b=a;else{var c=null;d.isFunction(a)?c=a:d.isFunction(a.getClass)&&(c=a.getClass());var e;e=d.isFunction(c)?c.prototype:a.prototype,b=e.__type,b||(b=a.type=a.type||d.uniqueId("type-"))}return this._normalizeTypeKey(b)},_normalizeTypeKey:function(a){if(!d.isString(a))return a;if(""===a)return"";var b=this.TYPE_KEY_DELIM;return 0===a.indexOf(b)&&(a=b.substring(b.length)),a.lastIndexOf(b)==a.length-b.length&&(a=a.substring(0,a.length-b.length)),a}});a.exports=g},function(a,b,c){var d=c(27),e=c(13),f=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._filterDataSets=d.bind(this._filterDataSets,this),this.setFilter(this.options.filterData||this.options.filter),this.open()},open:function(){return e.prototype.open.apply(this,arguments)?(d.each(this.options.dataSets,function(a){a.on("update",this._filterDataSets)},this),this._filterDataSets(),!0):!1},close:function(){return e.prototype.close.apply(this,arguments)?(d.each(this.options.dataSets,function(a){a.off("update",this._filterDataSets)},this),e.prototype.setData.call(this,[]),!0):!1},setFilter:function(a){return this._filter=a,this._filterDataSets(),this},_filterDataSets:function(){var a={},b=this.options.dataSets;d.each(b,function(b){d.each(b.getKeys(),function(b){a[b]=!0})},this);var c=[];d.each(d.keys(a),function(a){var e=d.map(b,function(b){var c=b.getDataEntries(a);return c}),f=this._filterData(a,e);f&&c.push(f)},this),e.prototype.setData.call(this,c)},_filterData:function(a,b){if(this._filter)return this._filter(a,b);var c=[{}].concat(b);return d.extend.call(null,c)},setData:function(){throw new Error("This method should not be called directly. This dataset is a combination of parent datasets.")}});f.OR=f.extend({_filterData:function(a,b){var c=d.find(b,function(a){return!!a});return c}}),f.AND=f.extend({_filterData:function(a,b){var c=null;return d.find(b,function(a){return c=a,!a})?null:c}}),a.exports=f},function(a,b,c){var d=(c(1),c(27)),e=c(16),f=e.extend({initialize:function(){if(e.prototype.initialize.apply(this,arguments),this._onDataSetUpdate=d.bind(this._onDataSetUpdate,this),!this.options.dataSet)throw new Error("Data set is not defined.")},getKey:function(a){return this.getDataSet().getKey(a)},open:function(){if(this._open)return!1;var a=this.getDataSet();return a.on("update:end",this._onDataSetUpdate),this._setData(a.getData()),this._open=!0,!0},close:function(){if(!this._open)return!1;var a=this.getDataSet();return this._setData([]),a.off("update:end",this._onDataSetUpdate),this._open=!1,!0},getDataSet:function(){return this.options.dataSet},_setData:function(a){var b=this;return b.triggerMethod("update:begin"),b._setObjects(a),b.triggerMethod("update:end"),this},_onDataSetUpdate:function(){var a=this.getDataSet(),b=a.getData();this._setData(b)}});a.exports=f},function(a,b,c){var d=c(1),e=c(27),f=d.Class.extend({setDependencies:function(a){e.each(a,function(a,b){this.setDependency(b,a)},this)},setDependency:function(a,b){var c=this;if(!c._checkDependencies(a,b))throw d.Errors.newError("Circular dependencies").code(400);c._setDependencies(a,b)},visit:function(a,b){b.begin&&b.begin(a);var c=this.getDependencies(a);e.each(c,function(a){this.visit(a,b)},this),b.end&&b.end(a)},callDependencies:function(a,b){var c=this;return d.P.then(function(){if(e.isArray(a)){var f={};return d.P.all(e.map(a,function(a){return c._callDependencies(f,a,b)}))}return c._callDependencies({},a,b)})},getDependencies:function(a){return this._getDependencies(a)},getAllDependencies:function(a){var b=[];return this.visit(a,{end:function(c){c!==a&&b.push(c)}}),b},_callDependencies:function(a,b,c){function f(b){return a[b]||(a[b]=d.P.then(function(){return c.begin?c.begin(b):void 0}).then(function(){var a=g.getDependencies(b);if(a&&a.length)return d.P.all(e.map(a,f))}).then(function(a){return c.end?c.end(b,null,a):a},function(a){if(c.end)return c.end(b,a,null);throw a})),a[b]}var g=this;return f(b)},_checkDependencies:function(a,b){var c=this,d=e.isArray(b)?b:[b];return f.check(a,function(b){return b===a?d:c.getDependencies(b)})},_getDependencies:function(a){return this._dependencies?this._dependencies[a]||[]:[]},_setDependencies:function(a,b){this._dependencies||(this._dependencies=[]),this._dependencies[a]=b}});f.check=function(a,b){function c(a){if(d[a])return!0;try{return d[a]=!0,!!e.find(b(a),c)}finally{delete d[a]}}var d={};return!c(a)},a.exports=f},function(a,b,c){var d=c(1),e=c(27),f=c(20),g=d.Class.extend({initApi:function(a,b,c){var d={},f=this;return c=c||e.functions(b),e.each(c,function(c){if("_"!=c[0]){var g=b[c],h=!0;if(g.intentHandler){var i=c,j=c.indexOf(":");h=!1,0>j&&(h=!0,i=a+":"+c,b[c]=function(a){a=a||{};var b=f.newIntent(i,a);return b.promise}),f.addIntentHandler(a,i,function(a){return g.call(b,a)})}b[c]=e.bind(b[c],b),h&&(d[c]=b[c])}}),d},newIntent:function(a,b){var c=new g.Intent(a,b);try{var d=this._intentHandlers?this._intentHandlers[a]:null;e.each(d,function(a,b){c._handleComponent(b,a)})}finally{c._finalize()}return c},addIntentHandlers:function(a,b){var c=e.toArray(arguments);b=c.pop(),a=this._checkComponentKey(c.pop()),e.each(b,function(b,c){this.addIntentHandler(a,c,b)},this)},addIntentHandler:function(a,b,c){var d=e.toArray(arguments);c=d.pop(),b=d.pop(),a=this._checkComponentKey(d.pop()),this._intentHandlers||(this._intentHandlers={});var f=this._intentHandlers[b]=this._intentHandlers[b]||{};f[a]=c},removeIntentHandlers:function(a,b){b||(b=a,a=null),e.each(b,function(b,c){this.removeIntentHandler(a,c,b)},this)},removeIntentHandler:function(a,b,c){if(this._intentHandlers){c||(d=b,b=a,a=null);var d=this._intentHandlers[b],f=[];a?e.each(d,function(a,b){c===a&&f.push(b)}):f.push(a),e.each(f,function(a){delete d[a]})}},_checkComponentKey:function(a){return a||e.uniqueId("$$cmp-")}});g.Intent=d.Class.extend({initialize:function(a,b){this._deferred=d.P.defer(),this._processed=d.P.defer(),this.intentKey=a,this.params=b,this.promise=this._deferred.promise,this.processed=this._processed.promise,this._handlerPromises={},this._dependencies=new f,this._handled=!1},resolve:function(a){return this._handled=!0,this._deferred.resolve(a),this._deferred.promise},reject:function(a){return this._handled=!0,this._deferred.reject(a),this._deferred.promise},then:function(a,b){return this._deferred.promise.then(a,b)},waitFor:function(a){if(!this._componentKey)throw new Error("Component handler is not defined. This method could be called only from an intent handler.");var b=this;return e.each(a,function(a){b._dependencies.setDependency(a)}),b._deferred.promise.then(function(c){return d.P.all(e.map(a,function(a){var c=b._handlerPromises[a];return c||(c=d.P()),c})).then(function(){return c})})},_handleComponent:function(a,b){var c,e=this;try{e._componentKey=a,c=d.P.resolve(b(e))}catch(f){c=d.P.reject(f)}finally{this._handlerPromises[a]=c,delete e._componentKey}},_finalize:function(){var a=this;a._handled||a.reject(new Error("An intent was not handled."));var b=function(){var b=e.keys(a._handlerPromises);return a._dependencies.callDependencies(b,{end:function(b,c){if(c)throw c;return a._handlerPromises[b]}}).then(function(b){return a._processed.resolve(b),b},function(b){throw a._processed.reject(b),b})};return a._deferred.promise.then(b,b)}}),g.handler=function(a){return a.intentHandler=!0,a},a.exports=g},function(a,b,c){var d=c(30),e=c(19),f=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._onZoomEnd=_.bind(this._onZoomEnd,this)},onAdd:function(a){this._map=a,this._map.on("zoomend",this._onZoomEnd),this._layer=new d.featureGroup,this._map.addLayer(this._layer),this.open(),this._onZoomEnd()
},onRemove:function(){this.close(),this._map.removeLayer(this._layer),this._map.off("zoomend",this._onZoomEnd),delete this._map,delete this._layer},_onEnter:function(a){return a.layer=this._newLeafletLayer(a),a.layer&&this._layer.addLayer(a.layer),a.emit("enter"),a},_onExit:function(a){return a.layer&&this._layer.removeLayer(a.layer),a.emit("exit"),a},_newLeafletLayer:function(){},_onZoomEnd:function(){var a=this,b=a._map.getZoom();_.each(a._index,function(a){a.emit("zoomend",{entry:a,zoom:b})})}});a.exports=f},function(a,b,c){var d=c(19),e=d.extend({_onEnter:function(a){var b=this.options.parent;if(b){var c=b._getIndexEntry(a.key);_.extend(a,c)}return a.emit("enter"),a},onAdd:function(){this.open()},onRemove:function(){this.close()}});a.exports=e},function(a,b,c){var d=c(27);a.exports={getDataSet:function(){return this.props.dataSet},componentWillMount:function(){var a=this.getDataSet();a.on("update:end",this._onUpdate)},componentWillUnmount:function(){var a=this.getDataSet();a.off("update:end",this._onUpdate)},_onUpdate:function(){var a=this;a.setState(a._newState())},getInitialState:function(){return this._newState()},_newState:function(){return{}},renderChildren:function(){var a=this.getDataSet(),b=d.map(a._getIndexEntries(),function(a){return this.renderChild(a)},this);return b}}},function(a,b,c){var d=(c(27),c(1)),e=c(17),f=d.Class.extend({initialize:function(a){this.setOptions(a),this._adapterManager=this.options.adapterManager||new e,this.options.getResourceType&&(this.getResourceType=this.options.getResourceType)},registerView:function(a,b,c){this._adapterManager.registerAdapter(a,b,c)},newView:function(a,b){return this._adapterManager.getAdapter(a,b)},hasView:function(a,b){var c=this._adapterManager.getAdapter(a,b);return!!c},getResourceType:function(a){return a.type||""}});a.exports=f},function(a){function b(a){this.reset(),"string"==typeof a?this.setURI(a):"object"==typeof a&&b._doCopy(a,this,!0)}function c(a){return a?Array.isArray?Array.isArray(a):"[object Array]"==Object.prototype.toString.call(a):!1}function d(a){return""===a||"."===a||".."===a}function e(a){return a&&""!==a&&"/"===a[a.length-1]?!0:!1}b.toURI=function(a){return new b(a).toString()},b.parse=function(a){return new b(a)},b.splitQuery=function(a){var b={};if(a&&""!==a)for(var d=a.split("&"),e=0;e<d.length;e++){var f=d[e],g=f.split("="),h=decodeURIComponent(g[0]),i=decodeURIComponent(g[1]);if(h in b){var j=b[h],k=j;c(k)||(k=b[h]=[j]),k.push(i)}else b[h]=i}return b},b.serializeQuery=function(a){var b="";for(var d in a)if(a.hasOwnProperty(d)){var e=a[d]||"",f=encodeURIComponent(d),g=e;c(g)||(g=[e]);for(var h=0;h<g.length;h++){b.length>0&&(b+="&");var i=encodeURIComponent(g[h]);b+=f,b+="=",b+=i}}return b},b.resolvePathSegments=function(a){for(var b=!1,c=a.length,e=d(a[0]),f=d(a[c-1]),g=0;c>g;g++){var h=a[g];d(h)?(b=!1,a.splice(g,1),c--,g--,".."==h&&g>=0&&(a.splice(g,1),c--,g--)):b=!0}return e&&a.splice(0,0,""),f&&(a=a.push("")),b},b._doCopy=function(a,c,d){for(var e in a)if(a.hasOwnProperty(e)){var f=a[e];"object"==typeof f&&d&&(f=b._doCopy(f,{})),c[e]=f}return c},b.prototype.reset=function(a,b){b||(delete this.scheme,delete this.authority,delete this.domain,delete this.port),a||(delete this.path,delete this.query,delete this.fragment)},b.prototype.resetDomain=function(){this.reset(!0)},b.prototype.asJSON=function(a){return JSON.stringify(this,null,a)},b.prototype.newCopy=function(){var a=this.newInstance();return b._doCopy(this,a,!0),a},b.prototype.newInstance=function(){return new b},b.prototype.setURI=function(a){a=a||"",a=a.replace(/[\\]/gi,"/");var c=a.lastIndexOf("#");if(c>=0&&(this.fragment=a.substring(c+1),a=a.substring(0,c)),c=a.indexOf("?"),c>=0){var d=a.substring(c+1);this.query=b.splitQuery(d),a=a.substring(0,c)}var e=!1;if(a.match(/^\/\//)?(a=a.substring("//".length),e=!0):(c=a.indexOf("://"),c>=0&&(this.scheme=a.substring(0,c),a=a.substring(c+"://".length),e=!0)),e){if(c=a.indexOf("/"),c>=0&&(this.path=a.substring(c),a=a.substring(0,c)),c=a.indexOf(":"),c>=0){try{this.port=parseInt(a.substring(c+1))}catch(f){}a=a.substring(0,c)}c=a.indexOf("@"),c>=0&&(this.authority=a.substring(0,c),a=a.substring(0,c)),this.domain=a.toLowerCase()}else this.path=a;return this},b.prototype.resolve=function(a){if("string"==typeof a&&(a=new b(a)),a.domain&&""!==a.domain)return a.newCopy();var c=this.newCopy(),d=a.path;if(0!==d.indexOf("/")){var f=c.path,g=(f.lastIndexOf("/"),f.split(/[\/]/gi)),h=e(f);h||g.pop();for(var i=d.split(/[\/]/gi),j=0;j<i.length;j++){var k=i[j];g.push(k)}{""===g[0],g.length>0&&""===g[g.length-1]}b.resolvePathSegments(g,!0),c.path=g.join("/")}else c.path=d;return c.query=a.query,c.fragment=a.fragment,c},b.prototype.toString=function(){var a="";if(this.scheme&&(a=this.scheme),(this.authority||this.domain)&&(""!==a&&(a+=":"),a+="//"),this.authority&&(a+=this.authority,a+="@"),this.domain&&(a+=this.domain),this.port&&(a+=":"+this.port),""!==this.path&&(a.length>0&&!this.path.match(/^[\/]/)&&(a+="/"),a+=this.path),this.query){var c=this.query;"string"!=typeof c&&(c=b.serializeQuery(c)),a+="?"+c}return this.fragment&&(a+="#"+this.fragment),a},a.exports=b},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d},function(a){a.exports=e},function(a,b,c){var d=(c(27),c(30)),e=(c(32),d.Class.extend({includes:d.Mixin.Events,options:{resolution:4,pointerCursor:!0},initialize:function(a){d.setOptions(this,a)},onAdd:function(a){this._map=a,this._container=this._map._container,a.on("mousemove",this._move,this)},onRemove:function(){var a=this._map;a.off("click",this._click,this),a.off("mousemove",this._move,this),this._removeMouseCursorStyle()},_click:function(a){var b=this._objectForEvent(a);b.data&&this.fire("click",b)},_move:function(a){var b=this._objectForEvent(a);b.data!==this._mouseOn?(this._mouseOn&&(this.fire("mouseout",{latlng:a.latlng,data:this._mouseOn}),this._removeMouseCursorStyle()),b.data&&(this.fire("mouseover",b),this._setMouseCursorStyle()),this._mouseOn=b.data):b.data&&this.fire("mousemove",b)},_setMouseCursorStyle:function(){this.options.pointerCursor&&(this._container._pointerCursorCount?this._container._pointerCursorCount++:(this._container._pointerCursorCount=1,this._container.style.cursor="pointer"))},_removeMouseCursorStyle:function(){this.options.pointerCursor&&this._container._pointerCursorCount&&(this._container._pointerCursorCount--,0===this._container._pointerCursorCount&&(this._container.style.cursor="",delete this._container._pointerCursorCount))},_objectForEvent:function(){throw new Error("This method should be implemented in subclasses.")}}));a.exports=e},function(a,b,c){{var d=c(27),e=c(30);c(1)}a.exports=e.Class.extend({includes:e.Mixin.Events,initialize:function(a){e.setOptions(this,a),d.defaults(this.options,{minZoom:0,maxZoom:25,tileSize:256})},onAdd:function(a){this._map=a,this._container=this._map._container,this._update()},onRemove:function(){},_update:function(){{var a=this._map.getZoom();this.options.tileSize}if(!(a>this.options.maxZoom||a<this.options.minZoom)){var b=this._map.getPixelBounds(),c=this._getTilePosition(b.min),d=this._getTilePosition(b.max),e=this._getTilesReferencesFromCenterOut(c,d),f={queue:e},g=this;g.fire("startLoading",f),g.options.loadTiles(a,e,function(a,b){a&&(f.errors=a),f.tiles=b,g.fire("endLoading",f)}),this.options.loadTiles=function(a,b,c){c(new Error("Not implemented"))}}},_getTilesReferencesFromCenterOut:function(a,b){for(var c=[],d=a.y;d<=b.y;d++)for(var e=a.x;e<=b.x;e++)c.push(this._newPoint(e,d));if(c.length){var f=this,g=this._newPoint((a.x+b.x)/2,(a.y+b.y)/2);c.sort(function(a,b){var c=f._distance(a,g)-f._distance(b,g);return c})}return c},_newPoint:function(a,b){return a.length&&(b=a[1],a=a[0]),{x:a,y:b,toString:function(){return JSON.stringify(this,null,2)}}},_distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},_getTilePosition:function(a){var b=this.options.tileSize;return this._newPoint(Math.floor(a.x/b),Math.floor(a.y/b))}})}])});