/* 
 * mosaic-core v0.0.0 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("mosaic-commons"),require("underscore"),require("leaflet"),require("jquery")):"function"==typeof define&&define.amd?define(["mosaic-commons","underscore","leaflet","jquery"],b):"object"==typeof exports?exports["mosaic-core"]=b(require("mosaic-commons"),require("underscore"),require("leaflet"),require("jquery")):a["mosaic-core"]=b(a["mosaic-commons"],a.underscore,a.leaflet,a.jquery)}(this,function(a,b,c,d){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1);d.Core=a.exports={DataSet:c(2),CompositeDataSet:c(3),DataSetView:c(4),DataSubsetView:c(5),LeafletDataSetView:c(6),LeafletDataSubsetView:c(7),LeafletFeatureBuilder:c(8),TemplateDataSetView:c(9),TemplateView:c(10)}},function(b){b.exports=a},function(a,b,c){var d,e;d=[c,c(1),c(11)],e=function(){var a=c(1),b=c(11),d=a.Class.extend(a.Events.prototype,{initialize:function(c){a.Events.call(this),this.setOptions(c),b.isFunction(this.options.getKey)&&(this.getKey=this.options.getKey),this._index={},this._data=[]},open:function(){this.options.data&&this.setData(this.options.data)},close:function(){},setData:function(a){var c=b.toArray(a),d={},e=[],f={enter:[],update:[],exit:[]};return b.each(c,function(a,c){var g=this.getKey(a);b.has(this._index,g)?(f.update.push(a),delete this._index[g]):f.enter.push(a),d[g]={d:a,i:c},e.push(a)},this),b.each(this._index,function(a){f.exit.push(a.d)},this),this._index=d,this._data=e,this.emit("update",f),this},getData:function(a){if(a){var b=this._index[a];return b?b.d:null}return this._data},getIndex:function(a){var b=this.getKey(a),c=b?this._index[b]:null;return c?c.i:-1},getKey:function(a){return a},getKeys:function(){return b.keys(this._index)}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(1),c(11),c(2)],e=function(){var a=(c(1),c(11)),b=c(2),d=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments),this._filterDataSets=a.bind(this._filterDataSets,this),this.setFilter(this.options.filterData||this.options.filter),this.open()},open:function(){a.each(this.options.dataSets,function(a){a.on("update",this._filterDataSets)},this),this._filterDataSets()},close:function(){a.each(this.options.dataSets,function(a){a.off("update",this._filterDataSets)},this),b.prototype.setData.call(this,[])},setFilter:function(a){return this._filter=a,this._filterDataSets(),this},_filterDataSets:function(){var c={},d=this.options.dataSets;a.each(d,function(b){a.each(b.getKeys(),function(a){c[a]=!0})},this);var e=[];a.each(a.keys(c),function(b){var c=a.map(d,function(a){var c=a.getData(b);return c}),f=this._filterData(b,c);f&&e.push(f)},this),b.prototype.setData.call(this,e)},_filterData:function(b,c){if(this._filter)return this._filter(b,c);var d=[{}].concat(c);return a.extend.call(null,d)},setData:function(){throw new Error("This method should not be called directly. This dataset is a combination of parent datasets.")}});return d.OR=d.extend({_filterData:function(b,c){var d=a.find(c,function(a){return!!a});return d}}),d.AND=d.extend({_filterData:function(b,c){var d=null;return a.find(c,function(a){return d=a,!a})?null:d}}),d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(1),c(11)],e=function(){var a=c(1),b=c(11),d=a.Class.extend({initialize:function(a){var b=this;b.setOptions(a),a=b.getOptions(),b._onEnter=a.onEnter,b._onExit=a.onExit,b._onUpdate=a.onUpdate},open:function(){var a=this.getDataSet();this._onDataSetUpdate=b.bind(this._onDataSetUpdate,this),this._onDataSetUpdate({enter:a.getData(),update:[],exit:[]}),a.on("update",this._onDataSetUpdate)},close:function(){var a=this.getDataSet();a.on("update",this._onDataSetUpdate),this._onDataSetUpdate({enter:[],update:[],exit:a.getData()})},setOptions:function(a){this.options=b.extend(this.options||{},a)},getOptions:function(){return this.options||{}},getDataSet:function(){var a=this.getOptions();return a.dataSet},_onDataSetUpdate:function(a){function c(a,c){c&&b.each(a,function(a){var b=e.getKey(a),f=d._getView(b);f=c.call(d,a,f),f&&d._setView(b,f)})}var d=this,e=d.getDataSet();b.each(a.exit,function(a){var b=e.getKey(a),c=d._getView(b);c&&(d._onExit&&d._onExit(a,c),d._removeView(b,c))}),c(a.enter,d._onEnter),c(a.update,d._onUpdate)},_getView:function(a){return this._index?this._index[a]:null},_setView:function(a,b){return this._index||(this._index={}),this._index[a]=b,this},_removeView:function(a){return this._index&&delete this._index[a],this}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(4)],e=function(){var a=c(4),b=a.extend({_getParentView:function(){var a=this.getOptions();return a.parent},_getView:function(b){var c=this._getParentView(),d=null;return c&&c._getView&&(d=c._getView(b)),d||(d=a.prototype._getView.call(this,b)),d}});return b}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(12),c(4)],e=function(){var a=c(12),b=c(4),d=b.extend({_setView:function(a,c){var d=this._getView(a);return b.prototype._setView.apply(this,arguments),d&&this._layer.removeLayer(d),this._layer.addLayer(c),this},_removeView:function(a,c){return b.prototype._removeView.apply(this,arguments),this._layer.removeLayer(c),this},onAdd:function(b){this._map=b,this._layer=new a.featureGroup,this._map.addLayer(this._layer),this.open()},onRemove:function(){this.close(),this._map.removeLayer(this._layer),delete this._map,delete this._layer}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(5)],e=function(){var a=c(5),b=a.extend({onAdd:function(a){this._map=a,this.open()},onRemove:function(){this.close(),delete this._map}});return b}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(1),c(12)],e=function(){var a=c(12),b=c(1),d=b.Class.extend({initialize:function(a,b){this.data=a,_.extend(this,b);var c=["onClick","onMouseOver","onMouseOut","onDblClick","onMouseMove"];this._handlers={},_.each(c,function(a){var b=a.toLowerCase().substring(2);this[a]=function(a){return void 0!==a?(this._handlers[b]=a,this):this_handlers[b]}},this)},setOptions:function(a){return this.opt=a,this},getOptions:function(){var a=_.toArray(arguments);return this._getOrInvoke(this.opt,a)||{}},setMarker:function(a){return this._marker=a,this},getMarker:function(){var a=_.toArray(arguments);return this._getOrInvoke(this._marker,a)},build:function(){var b=this,c=b.data,d=c.geometry;if(b._isEmptyGeometry(d))return!1;var e=b.getOptions(c),f=a.GeoJSON.geometryToLayer(c,function(c,d){var f=b.getMarker(d,e);return f||(f=new a.Marker(d,e)),f},a.GeoJSON.coordsToLatLng,e);return _.each(b._handlers,function(a,b){f.on(b,function(b){a(c,b)})}),f},_getOrInvoke:function(a,b){return _.isFunction(a)?a.apply(a,b):a},_isEmptyGeometry:function(a){return a&&a.coordinates&&a.coordinates.length&&("Point"!=a.type||a.coordinates[0]&&a.coordinates[1])?!1:!0}}),e=function(a,b){return new d(a,b)};return e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(11),c(1),c(4),c(10)],e=function(){var a=(c(11),c(1),c(4)),b=c(10),d=a.extend(b.prototype,{initialize:function(){a.prototype.initialize.apply(this,arguments),b.prototype.initialize.apply(this,arguments)},onRenderBegin:function(){this.open()},onRemove:function(){this.close()},_setView:function(b,c){var d=this,e=d._getView(b);a.prototype._setView.apply(d,arguments),e&&e.remove(),c.render();var f=d.getElement();return f.append(c.getElement()),d},_removeView:function(b,c){return a.prototype._removeView.apply(this,arguments),c.remove(),this}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(11),c(13),c(1)],e=function(){function a(a){return a?a=a.replace(/^[\n\r\s]+|[\n\r\s]$/gim,""):""}function b(b){var c=[];return b.each(function(){try{var b=e(this).text();b=a(b),b="( "+b+")";var f=eval,g=f(b);d.isFunction(g)&&(g=g()),c.push(g)}catch(h){console.log("ERROR!",h.stack)}}),c}var d=c(11),e=c(13),f=c(1),g=f.Class.extend({type:"TemplateView",triggerMethod:f.Events.triggerMethod,listenTo:f.Events.listenTo,stopListening:f.Events.stopListening,initialize:function(a){f.Events.apply(this,arguments),this.setOptions(a),this.triggerMethod("initialize")},getElement:function(){if(!this.$el){var a=this.options.el||"<div></div>";this.$el=e(a)}return this.$el},renderDefault:function(a,b){var c=new Error("["+b+"]: Renderer method not found.");console.log(c.stack,a)},renderedDefault:function(a,b){var c=new Error("["+b+"]: Method called after the rendering process is not defined.");console.log(c.stack,a)},handleDefault:function(a,b){var c=new Error("["+b+"]: A handler method with such a name was not found.");console.log(c.stack,a)},renderElement:function(a,b){var c=[];this._renderElement(a,b,c),d.each(c,function(a){this._callReferencedMethod(a,"data-rendered","renderedDefault")},this)},bindListeners:function(a,b,c){var f=a[0];if(f){void 0===c&&(c="data-action-"+b);var g=this,h="["+c+"]";a.on(b,h,function(a){var b=e(a.currentTarget),f=b.attr(c),h=g[f];d.isFunction(h)?h.call(g,a,b):g.handleDefault(b,f)})}},render:function(){var a=this;return a.triggerMethod("render:begin"),a._render(),a._bindEventListeners(),a.triggerMethod("render:end"),this},remove:function(){this.triggerMethod("remove"),this.stopListening();var a=this.getElement();return a.remove(),this},_callReferencedMethod:function(a,b,c){var d=null,e=a.attr(b);if(e){var f=this[e]||this[c];a.removeAttr(b),f&&(d=f.call(this,a,e))}return d},_renderElement:function(a,b,c){var f=!0;if(b!==!1){a.attr("data-rendered")&&c.push(a);var g=this._callReferencedMethod(a,"data-render","renderDefault");f=g!==!1}if(f){var h=d.toArray(a.children());d.each(h,function(a){this._renderElement(e(a),!0,c)},this)}this.triggerMethod("render")},_bindEventListeners:function(){var a=["click","mouseover","mouseout","focus","blur","keypress","keydown","keyup"],b=this.getElement();d.each(a,function(a){this.bindListeners(b,a)},this)},_render:function(){var a=this,b=a.getElement();return a._renderTemplate(),a.className&&b.attr("class",a.className),a.renderElement(b),a},_renderTemplate:function(){var a=this,b=a.template;if(b){var c=d.extend({},a.options,{view:a});d.isString(b)&&(b=d.template(b));var e=b(c),f=a.getElement();f.html(e)}}});return g.extendViewType=function(c,f){c=e(c).clone(),f=f||this.extend({});var g=c.find('script[data-type="static"]');d.each(b(g),function(a){d.extend(f,a)},this),g.remove(),g=c.find("script"),d.each(b(g),function(a){d.extend(f.prototype,a)},this),g.remove();var h=c.html();return h=a(h),h&&""!==h&&(f.prototype.template=h),f},g}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d}])});