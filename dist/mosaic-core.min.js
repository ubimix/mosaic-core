/* 
 * mosaic-core v0.0.8 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("mosaic-commons"),require("underscore"),require("mosaic-teleport"),require("leaflet"),require("react")):"function"==typeof define&&define.amd?define(["mosaic-commons","underscore","mosaic-teleport","leaflet","react"],b):"object"==typeof exports?exports["mosaic-core"]=b(require("mosaic-commons"),require("underscore"),require("mosaic-teleport"),require("leaflet"),require("react")):a["mosaic-core"]=b(a["mosaic-commons"],a.underscore,a["mosaic-teleport"],a.leaflet,a.react)}(this,function(a,b,c,d,e){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c,c(1),c(2),c(3),c(4),c(5),c(6),c(7),c(8),c(9),c(10),c(11),c(12),c(13),c(14),c(15),c(16),c(17),c(18),c(19),c(20),c(21),c(22),c(23),c(24),c(25),c(26)],e=function(){var a=c(1);return a.App=c(2),a.App.Actions=c(3),a.App.Api=c(4),a.App.Component=c(5),a.App.Store=c(6),a.React={FilterBox:c(17),SearchBoxMixin:c(18)},a.Leaflet={ReactMap:c(12),FeatureBuilder:c(14),UtfGrid:c(15),MapViewport:c(16)},a.Core={DataSet:c(8),ActivationTree:c(23),InfiniteScroll:c(25),AbstractSet:c(7),AdapterManager:c(19),CompositeDataSet:c(9),DataSetView:c(10),Dependencies:c(20),Intents:c(21),LeafletDataSetView:c(11),LeafletDataSubsetView:c(13),LeafletFeatureBuilder:c(14),ReactDataSetMixin:c(24),ViewManager:c(22),URI:c(26)},a.Core}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(b){b.exports=a},function(a,b,c){var d,e;d=[c,c(1),c(21)],e=function(){var a=c(1),b=c(21);return a.Class.extend(a.Events.prototype,{initialize:function(a){this.setOptions(a),this.intents=new b,this.initModules()},start:function(){var b=this;return a.P.then(function(){return b.preloadData()}).then(function(){return b.initViews()},function(a){return b.initViews(a)})},stop:function(){var b=this;return a.P.then(function(){return b.deleteViews()}).then(function(){return b.deleteModules()})},preloadData:function(){},initModules:function(){},deleteModules:function(){},initViews:function(){},deleteViews:function(){}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(5)],e=function(){var a=(c(27),c(5));return a.extend({})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(28),c(5)],e=function(){function a(a){return a?b.isArray(a)?a:b.isArray(a.features)?a.features:a:a}var b=c(27),d=c(5),e=c(1),f=d.extend({initialize:function(a){this.setOptions(a),this.app=this.options.app,this._initFields(),this.api=this._initApi(this.options.key)},notify:function(){this.emit("changed")},addChangeListener:function(a,b){this.on("changed",a,b)},removeChangeListener:function(a,b){this.off("changed",a,b)},_initFields:function(){},_initApi:function(a){var b=this._getIntents(),c=this._getApiMethods();return this.api=b.initApi(a,this,c),this.api},_getApiMethods:function(){var a={};return b.each(b.functions(this),function(b){"_"!=b[0]&&(b.match(/^on.+$/)||(a[b]=!0))}),b.each(b.functions(d.prototype),function(b){delete a[b]},this),b.keys(a).sort()},_getIntents:function(){var a=this.intents||this.options.intents;return!a&&this.app&&(a=this.app.intents),a},_loadAndMergeGeoJsonArrays:function(a){var c=this;return a=b.isString(a)?[a]:b.toArray(a),e.P.all(b.map(a,function(a){return c._loadGeoJsonArray(a)})).then(function(a){var c=[];return b.each(a,function(a){c=c.concat(a)}),c})},_getGeoJsonArray:function(b){return this._getJson(b).then(a)},_loadGeoJsonArray:function(c){var d=b.isString(c)?c:c.path;return this._loadJson(d).then(a)},_getJson:function(a){var b=this;return e.P.then(function(){var c,d=a.path,e=a.noCache,f=a.force,g=b._cache=b._cache||{};return e||f||(c=g[d]),c?c:b._loadJson(d).then(function(a){return e||(g[d]=a),a})})},_loadJson:function(a){var b=this;return e.P.then(function(){var c=b.app.options.baseUrl,d=e.Teleport.HttpClient.newInstance({baseUrl:c});return d.exec({path:a,method:"GET"})})}});return f.intent=function(a){return a.intentHandler=!0,a},f.toArray=a,f}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(1)],e=function(){var a=c(1);return a.Class.extend(a.Events.prototype,{initialize:function(a){this.setOptions(a),this.app=this.options.app}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(5)],e=function(){var a=c(27),b=c(5);return b.extend({setOptions:function(){b.prototype.setOptions.apply(this,arguments),this.options.app&&(this.app=this.options.app)},_addActions:function(b){var c=this;c.actions||(c.actions={}),a.each(b,function(a){c.actions[a]=function(b){return c.app.intents.newIntent(a,b).promise}})},initialize:function(a){this.setOptions(a),this._initFields()},notify:function(){this.emit("changed")},addChangeListener:function(a,b){this.on("changed",a,b)},removeChangeListener:function(a,b){this.off("changed",a,b)},_initFields:function(){}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1)],e=function(){var a=c(1),b=c(27),d=a.Class.extend(a.Events.prototype,a.Events,{initialize:function(a){b.extend(this,a)}}),e=a.Class.extend(a.Events.prototype,a.Events,{initialize:function(a){this.setOptions(a),b.isFunction(this.options.getKey)&&(this.getKey=this.options.getKey),this._index={}},_setObjects:function(a){var c=this,d=b.toArray(a),e={},f={enter:{},update:{},exit:{}};return b.each(d,function(a,d){var g,h=c.getKey(a);b.has(c._index,h)?(g=c._onUpdate(c._index[h])||g,delete c._index[h],f.update[g.key]=g):(g=c._newSetEntry({key:h,obj:a,idx:d}),g=c._onEnter(g)||g,f.enter[g.key]=g),e[h]=g}),b.each(c._index,function(a){f.exit[a.key]=c._onExit(a)||a}),c._index=e,f},_newSetEntry:function(a){return new d(a)},_getIndexEntries:function(a){return a?b.isArray(a)?b.map(a,function(a){return this._index[a]},this):this._index[a]:b.values(this._index)},_getIndexEntry:function(a){return this._index[a]},getKey:function(a){return a},getKeys:function(){return b.keys(this._index)},_onEnter:function(a){return a.emit("enter"),a},_onExit:function(a){return a.emit("exit"),a},_onUpdate:function(a){return a.emit("update"),a},getIndex:function(a){var b=a?this._index[a]:null;return b?b.idx:-1},hasKey:function(a){return b.has(this._index,a)}});return e.SetEntry=d,e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(7),c(1)],e=function(){var a=(c(1),c(7)),b=c(27),d=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments),this._open=!1},open:function(){return this._open?!1:(this.triggerMethod("open"),this.options.data&&this.setData(this.options.data),this._open=!0,!0)},close:function(){return this._open?(this.setData([]),this.triggerMethod("close"),this._open=!1,!0):!1},setData:function(a){this.triggerMethod("update:begin");var b=this._setObjects(a);return this.triggerMethod("update",b),this.triggerMethod("update:end"),this},getData:function(a){if(a){var c=this._index[a];return c?c.obj:null}return b.map(this._index,function(a){return a.obj})},getDataEntries:function(a){if(a){var c=this._index[a];return c}return b.values(this._index)},getDataIndex:function(a){var b=this.getKey(a);return this.getIndex(b)}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(8)],e=function(){var a=c(27),b=c(8),d=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments),this._filterDataSets=a.bind(this._filterDataSets,this),this.setFilter(this.options.filterData||this.options.filter),this.open()},open:function(){return b.prototype.open.apply(this,arguments)?(a.each(this.options.dataSets,function(a){a.on("update",this._filterDataSets)},this),this._filterDataSets(),!0):!1},close:function(){return b.prototype.close.apply(this,arguments)?(a.each(this.options.dataSets,function(a){a.off("update",this._filterDataSets)},this),b.prototype.setData.call(this,[]),!0):!1},setFilter:function(a){return this._filter=a,this._filterDataSets(),this},_filterDataSets:function(){var c={},d=this.options.dataSets;a.each(d,function(b){a.each(b.getKeys(),function(a){c[a]=!0})},this);var e=[];a.each(a.keys(c),function(b){var c=a.map(d,function(a){var c=a.getDataEntries(b);return c}),f=this._filterData(b,c);f&&e.push(f)},this),b.prototype.setData.call(this,e)},_filterData:function(b,c){if(this._filter)return this._filter(b,c);var d=[{}].concat(c);return a.extend.call(null,d)},setData:function(){throw new Error("This method should not be called directly. This dataset is a combination of parent datasets.")}});return d.OR=d.extend({_filterData:function(b,c){var d=a.find(c,function(a){return!!a});return d}}),d.AND=d.extend({_filterData:function(b,c){var d=null;return a.find(c,function(a){return d=a,!a})?null:d}}),d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(7)],e=function(){var a=(c(1),c(27)),b=c(7),d=b.extend({initialize:function(){if(b.prototype.initialize.apply(this,arguments),this._onDataSetUpdate=a.bind(this._onDataSetUpdate,this),!this.options.dataSet)throw new Error("Data set is not defined.")},getKey:function(a){return this.getDataSet().getKey(a)},open:function(){if(this._open)return!1;var a=this.getDataSet();return a.on("update:end",this._onDataSetUpdate),this._setData(a.getData()),this._open=!0,!0},close:function(){if(!this._open)return!1;var a=this.getDataSet();return this._setData([]),a.off("update:end",this._onDataSetUpdate),this._open=!1,!0},getDataSet:function(){return this.options.dataSet},_setData:function(a){var b=this;return b.triggerMethod("update:begin"),b._setObjects(a),b.triggerMethod("update:end"),this},_onDataSetUpdate:function(){var a=this.getDataSet(),b=a.getData();this._setData(b)}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(29),c(10)],e=function(){var a=c(29),b=c(10),d=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments),this._onZoomEnd=_.bind(this._onZoomEnd,this)},onAdd:function(b){this._map=b,this._map.on("zoomend",this._onZoomEnd),this._layer=new a.featureGroup,this._map.addLayer(this._layer),this.open(),this._onZoomEnd()},onRemove:function(){this.close(),this._map.removeLayer(this._layer),this._map.off("zoomend",this._onZoomEnd),delete this._map,delete this._layer},_onEnter:function(a){return a.layer=this._newLeafletLayer(a),a.layer&&this._layer.addLayer(a.layer),a.emit("enter"),a},_onExit:function(a){return a.layer&&this._layer.removeLayer(a.layer),a.emit("exit"),a},_newLeafletLayer:function(){},_onZoomEnd:function(){var a=this,b=a._map.getZoom();_.each(a._index,function(a){a.emit("zoomend",{entry:a,zoom:b})})}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(30),c(29)],e=function(){"use strict";var a=c(27),b=c(30),d=c(29);return b.createClass({displayName:"ReactMap",render:function(){return b.DOM.div({ref:"container",id:this.props.id,className:this.props.className})},componentDidMount:function(){var a=this.refs.container.getDOMNode();this.map=this._newMap(a),this.map.on("zoomend",this._updateZoomStyles,this),this.props.onMapAdd&&this.props.onMapAdd(this.map),this._updateZoomStyles()},componentWillUnmount:function(){this.props.onMapRemove&&this.props.onMapRemove(this.map),this.map.off("zoomend",this._updateZoomStyles,this),this.map.remove(),delete this.map},_newMap:function(b){var c=this.props.options||{},e=a.extend({},c,{zoomControl:!1,attributionControl:!1}),f=d.map(b,e);if(e=a.extend({},c.zoomControl),e=a.defaults(e,{position:"topright"}),c.zoomControl!==!1){var g=d.control.zoom(e);f.addControl(g)}if(c.attributionControl!==!1){var h=d.control.attribution(e);f.addControl(h)}var i=c.center;a.isArray(i)&&(i=d.latLng(i[1],i[0]));var j=c.zoom;return i&&void 0!==j&&f.setView(i,j),f},_updateZoomStyles:function(){for(var a=this.getDOMNode(),b=this.map.getZoom(),c=[],d=0;b>=d;d++)c.push("zoom-"+d);var e=a.className;e=e.replace(/zoom-\d+\s*/gim,""),e+=" "+c.join(" "),a.className=e}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(10)],e=function(){var a=c(10),b=a.extend({_onEnter:function(a){var b=this.options.parent;if(b){var c=b._getIndexEntry(a.key);_.extend(a,c)}return a.emit("enter"),a},onAdd:function(){this.open()},onRemove:function(){this.close()}});return b}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(1),c(29)],e=function(){var a=c(29),b=c(1),d=b.Class.extend({initialize:function(a,b){b||(b=a,a=null),this.data=a,_.extend(this,b);var c=["onClick","onMouseOver","onMouseOut","onDblClick","onMouseMove"];this._handlers={},_.each(c,function(a){var b=a.toLowerCase().substring(2);this[a]=function(a){return void 0!==a?(this._handlers[b]=a,this):this._handlers[b]}},this)},setEventBinder:function(a){return this.bindEventHandlers=a,this},bindEventHandlers:function(a,b){var c=this;_.each(c._handlers,function(c,d){b.on(d,function(b){c(a,b)})})},setOptions:function(a){return this.opt=a,this},getOptions:function(){var a=_.toArray(arguments);return this._getOrInvoke(this.opt,a)||{}},setMarker:function(a){return this._marker=a,this},getMarker:function(){var a=_.toArray(arguments);return this._getOrInvoke(this._marker,a)},build:function(b){var c=this;b=b||c.data;var d=b.geometry;if(c._isEmptyGeometry(d))return null;var e,f=c.getOptions(b),g=a.GeoJSON.geometryToLayer(b,function(b,d){return e=c.getMarker(b,f),void 0===e&&(e=new a.Marker(d,f)),e},a.GeoJSON.coordsToLatLng,f);return g&&!e&&(e=c.getMarker(b,f),e&&(g=a.featureGroup([g,e]))),this.bindEventHandlers(b,g),g},_getOrInvoke:function(a,b){return _.isFunction(a)?a.apply(a,b):a},_isEmptyGeometry:function(a){return a&&a.coordinates&&a.coordinates.length&&("Point"!=a.type||a.coordinates[0]&&a.coordinates[1])?!1:!0}}),e=function(a,b){return new d(a,b)};return e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(27),c(29),c(1),c(31)],e=function(a,b,c,d){var e=d.extend({initialize:function(b){var c=d.prototype;c.initialize.call(this,b),a.defaults(this.options,{resolution:4,pointerCursor:!0}),this._loader=this.options.loader||new MapTilesLoader(this.options)},_objectForEvent:function(a){var b,c=this._map,d=c.getZoom(),e=c.project(a.latlng),f=this._getTilePosition(e),g=this._loader.getTile(d,f);return g&&(b=this._getTileObject(g,e)),{latlng:a.latlng,data:b}},_getTileObject:function(a,b){var c=this._getTileShift(b.x),d=this._getTileShift(b.y),e=this._utfDecode(a.grid[d].charCodeAt(c)),f=a.keys[e],g=this._processData(a.data[f]);return g},getTileObjects:function(b){return b&&b.data?a.map(a.values(b.data),this._processData,this):[]},_processData:function(a){return a?(this._processDataF||(this._processDataF=this.options.processData||function(a){return a}),this._processDataF(a)):a},_getTileShift:function(a){var b=this.options.tileSize,c=this.options.resolution;return Math.floor((a-Math.floor(a/b)*b)/c)},_utfDecode:function(a){return a>=93&&a--,a>=35&&a--,a-32}});return e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(29)],e=function(a,b){"use strict";var c=b.Class.extend({initialize:function(a){b.setOptions(this,a);var c=this.options.viewport;c&&this.setViewport(c),this.options.focus&&this.setFocusPosition(this.options.focus)},getMap:function(){return this.options.map},setViewport:function(a){this._viewport=b.bounds(a),this._focusPos||(this._focusPos=this._viewport.getCenter())},getViewport:function(){if(this._viewport)return this._viewport;var a=this.getMap();return b.bounds([0,0],a.getSize())},setFocusPosition:function(a){this._focusPos=b.point(a.left,a.top)},focusTo:function(a,b,c){"function"==typeof b&&(c=b,b=null),c=this._checkCallback(c);var d=this.getMap();if(b=b||this._focusPos,d.once("moveend",c),b){var e=d._getTopLeftPoint();e._add(b);var f=d.project(a).subtract(e);d.panBy(f)}else d.panTo(a)},zoomTo:function(a,b){var c=this.getMap();b=this._checkCallback(b),c.getZoom()==a?b():(c.once("zoomend",b),c.setZoom(a))},panInsideBounds:function(a,b){var c=this,d=c.getMap();b=c._checkCallback(b);var e=c._getViewportPadding(),f=d.getBoundsZoom(a,!0,e);c.zoomTo(f,function(){var e=c._focusPos,g=d._limitCenter(e,f,a);center.equals(g)?b():c.focusTo(g,b)})},fitBounds:function(a){var b=(this.getViewport(),this._getViewportPadding()),c={};c.paddingTopLeft=b.min,c.paddingBottomRight=b.max;var d=this.getMap();d.fitBounds(a,c)},_checkCallback:function(a){return a||function(){}},_getViewportPadding:function(){var a=this.getViewport(),c=a.min,d=this.getMap(),e=d.getSize(),f=e.subtract(a.max);return b.bounds(c,f)}});return c}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(30),c(1)],e=function(){var a=c(27),b=c(1),d=c(30),e=b.Class.extend(b.Events.prototype,{initialize:function(b){this.values=[],a.extend(this,b)},set:function(b){return a.isArray(b)||(b=[]),this.values=b,this._notify("set"),this},getAll:function(){return this.values},add:function(a){return this.values.push(this.newFilterValue(a)),this._notify("add"),this},remove:function(b){var c=this.values.length;return this.values=a.filter(this.values,function(a){return a!=b}),this.values.length!=c&&this._notify("remove"),this},newFilterValue:function(a){return{label:a}},setFocused:function(a,b){var c=!1;this._focused!==a&&(c=!0,this._focused=a,b||this.emit("focus",this._focused))},isFocused:function(){return!!this._focused},_notify:function(a){return a&&this.emit(a),this.emit("changed"),this},addChangeListener:function(a,b){return this.on("changed",a,b),this},removeChangeListener:function(a,b){return this.off("changed",a,b),this}});return d.createClass({displayName:"React.FilterBox",statics:{Model:e,extendModel:function(a){return e.extend(a)}},getInitialState:function(){return this._newState({})},componentWillMount:function(){this.props.model.addChangeListener(this._notifyUpdates)},componentWillUnmount:function(){this.props.model.removeChangeListener(this._notifyUpdates)},componentDidMount:function(){this.componentDidUpdate()},componentDidUpdate:function(){if(this.props.model.isFocused()){var a=this.refs.input,b=a.getDOMNode();b.focus()}},_notifyUpdates:function(){this.setState(this._newState({text:""})),this.props.model.setFocused(!0)},_newState:function(b){var c=this.props.model;return a.extend({text:"",values:c.getAll()},this.state,b)},_addValue:function(a){a&&""!==a&&this.props.model.add(a)},_removeLastValue:function(){var a=this.props.model,b=a.getAll();b&&b.length&&a.remove(b[b.length-1])},_focusInput:function(){this.props.model.setFocused(!0),this.forceUpdate()},_handleInputFocus:function(){this.props.model.setFocused(!0)},_handleInputBlur:function(){this._addValue(this.state.text),this.props.model.setFocused(!1,!0)},_handleInputChange:function(){var a=this.refs.input.getDOMNode(),b=a.value,c=this._getInputSize(b);a.size=c,this.setState(this._newState({text:b}))},_handleKeyDown:function(a){var b=!1;9===a.which?(this._addValue(this.state.text),this.props.model.setFocused(!0),b=!0):8===a.which&&""===this.state.text?(this._removeLastValue(),b=!0):13===a.which?(this._addValue(this.state.text),this.props.onSubmit&&this.props.onSubmit(a),b=!0):27==a.which&&(b=!0),b&&(this.setState(this._newState({text:""})),a.preventDefault(),a.stopPropagation())},_handleItemClick:function(a,b){this.props.model.remove(a),b.preventDefault(),b.stopPropagation()},_formatTags:function(){var b=this.props.model;return a.map(b.getAll(),function(b){if(a.isFunction(b.format))return b.format();var c="item tag";return b.className&&(c+=" "+b.className),d.DOM.a({key:a.uniqueId("id-"),href:"#",className:c,onClick:this._handleItemClick.bind(this,b)},b.label)},this)},render:function(){var b=(this.props.app,this.props.className||"filter-box");this.props.model.isFocused()&&(b+=" focused");var c=this.state.text,e=this._getInputSize(c);return d.DOM.div(a.extend({},this.props.options,{onClick:this._focusInput,className:b}),this._formatTags(),d.DOM.input(a.extend({className:"item"},this.props.inputOptions,{ref:"input",size:e,type:"text",onFocus:this._handleInputFocus,onBlur:this._handleInputBlur,onChange:this._handleInputChange,onKeyDown:this._handleKeyDown,value:c})))},_getInputSize:function(a){return a=a||"",Math.min(50,Math.max(a.length,3))}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(30),c(1),c(17)],e=function(){var a=c(27),b=(c(30),c(1),c(17)),d=b.extendModel({_convertSearchToFilters:function(b){var c=[];return a.map(b,function(b,d){a.isArray(b)?a.each(b,function(a){c.push(this.newFilterValue(a,d))},this):c.push(this.newFilterValue(b,d))},this),c},convertFiltersToSearch:function(b){var c={};return a.each(b,function(b){var d=b.key,e=this.newSearchValue(b,d);if(a.has(c,d)){var f=c[d];f.push(e)}else c[d]=[e]},this),c},newFilterValue:function(a,b){return{key:b||this.getDefaultField(),label:a}},newSearchValue:function(a){return a.label},getDefaultField:function(){return this.textSearchField||"q"}}),e={Model:d,componentWillMount:function(){var a=this._getFilterBoxModel();a.on("add",this._onFilterBoxChanged,this),a.on("remove",this._onFilterBoxChanged,this)},componentDidUnmount:function(){var a=this._getFilterBoxModel();a.off("add",this._onFilterBoxChanged,this),a.off("remove",this._onFilterBoxChanged,this),delete this._model},_convertSearchToFilters:function(a){var b=this._getFilterBoxModel();return b._convertSearchToFilters(a)},_convertFiltersToSearch:function(a){var b=this._getFilterBoxModel();return b.convertFiltersToSearch(a)},_getFilterBoxModel:function(){var b=this;return b._model||(b._model=a.isFunction(b._newFilterModel)?b._newFilterModel():new d),b._model},_onFilterBoxChanged:function(){var a=this.getSearchCriteria();this._onSearchCriteriaChanged(a)},setSearchCriteria:function(a){var b=this._getFilterBoxModel(),c=this._convertSearchToFilters(a);b.set(c)},getSearchCriteria:function(){var a=this._getFilterBoxModel(),b=a.getAll(),c=this._convertFiltersToSearch(b);return c},renderSearchBox:function(c){return b(a.extend({},c,{model:this._getFilterBoxModel()}))}};return e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1)],e=function(){"use strict";var a=c(27),b=c(1),d=b.Class,e=d.extend({TYPE_KEY_DELIM:"/",initialize:function(){this._adapters={},this._cache={}},_getKey:function(a,b){var c=this.getTypeKey(a),d=this.getTypeKey(b);return c+"::"+d},registerAdapter:function(a,b,c){var d=this._getKey(a,b);this._adapters[d]=c,this._cache={}},getAdapter:function(b,c){var d=this,e=d._getKey(b,c),f=d._cache[e];return f||a.has(d._cache,e)||(a.find(d._expandId(b),function(b){return a.find(d._expandId(c),function(a){var c=d._getKey(b,a);return f=d._adapters[c],!!f}),!!f}),d._cache[e]=f),f},newAdapterInstance:function(b,c,d){var e=this.getAdapter(b,c),f=null;return a.isFunction(e)?(d=d||{},this._checkValidity(e,d)&&(a.isFunction(e.initialize)&&e.initialize(d),f=new e(d),this._checkValidity(f,d)||(f=null))):f=e,f},removeAdapter:function(a,b){var c=this._getKey(a,b),d=this._adapters[c];return delete this._adapters[c],delete this._cache[c],d},_checkValidity:function(b,c){if(!a.isFunction(b.isValid))return!0;var d=b.isValid(c);return d},_expandId:function(b){if(!b)return[];for(var c=[],d=!1;a.isFunction(b.getParent)&&(d=!0,b=b.getParent());)c.push(b);if(!d&&a.isString(b)){b=this._normalizeTypeKey(b);for(var e=this.TYPE_KEY_DELIM,f=b.split(e);f.length;){var g=f.join(e);c.push(g),f.pop()}c.push("")}return c},getTypeKey:function(b){var c;if(b)if(a.isString(b))c=b;else{var d=null;a.isFunction(b)?d=b:a.isFunction(b.getClass)&&(d=b.getClass());var e;e=a.isFunction(d)?d.prototype:b.prototype,c=e.__type,c||(c=b.type=b.type||a.uniqueId("type-"))}return this._normalizeTypeKey(c)},_normalizeTypeKey:function(b){if(!a.isString(b))return b;if(""===b)return"";var c=this.TYPE_KEY_DELIM;return 0===b.indexOf(c)&&(b=c.substring(c.length)),b.lastIndexOf(c)==b.length-c.length&&(b=b.substring(0,b.length-c.length)),b}});return e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(7)],e=function(){var a=c(1),b=c(27),d=a.Class.extend({setDependencies:function(a){b.each(a,function(a,b){this.setDependency(b,a)},this)},setDependency:function(b,c){var d=this;if(!d._checkDependencies(b,c))throw a.Errors.newError("Circular dependencies").code(400);d._setDependencies(b,c)},visit:function(a,c){c.begin&&c.begin(a);var d=this.getDependencies(a);b.each(d,function(a){this.visit(a,c)},this),c.end&&c.end(a)},callDependencies:function(c,d){var e=this;return a.P.then(function(){if(b.isArray(c)){var f={};return a.P.all(b.map(c,function(a){return e._callDependencies(f,a,d)}))}return e._callDependencies({},c,d)})},getDependencies:function(a){return this._getDependencies(a)},getAllDependencies:function(a){var b=[];return this.visit(a,{end:function(c){c!==a&&b.push(c)}}),b},_callDependencies:function(c,d,e){function f(d){return c[d]||(c[d]=a.P.then(function(){return e.begin?e.begin(d):void 0}).then(function(){var c=g.getDependencies(d);if(c&&c.length)return a.P.all(b.map(c,f))}).then(function(a){return e.end?e.end(d,null,a):a},function(a){if(e.end)return e.end(d,a,null);throw a})),c[d]}var g=this;return f(d)},_checkDependencies:function(a,c){var e=this,f=b.isArray(c)?c:[c];return d.check(a,function(b){return b===a?f:e.getDependencies(b)})},_getDependencies:function(a){return this._dependencies?this._dependencies[a]||[]:[]},_setDependencies:function(a,b){this._dependencies||(this._dependencies=[]),this._dependencies[a]=b}});return d.check=function(a,c){function d(a){if(e[a])return!0;try{return e[a]=!0,!!b.find(c(a),d)}finally{delete e[a]}}var e={};return!d(a)},d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(20)],e=function(){var a=c(1),b=c(27),d=c(20),e=a.Class.extend({initApi:function(a,c,d){var e={},f=this;return d=d||b.functions(c),b.each(d,function(d){if("_"!=d[0]){var g=c[d],h=!0;if(g.intentHandler){var i=d,j=d.indexOf(":");h=!1,0>j&&(h=!0,i=a+":"+d,c[d]=function(a){a=a||{};var b=f.newIntent(i,a);return b.promise}),f.addIntentHandler(a,i,function(a){return g.call(c,a)})}c[d]=b.bind(c[d],c),h&&(e[d]=c[d])}}),e},newIntent:function(a,c){var d=new e.Intent(a,c);try{var f=this._intentHandlers?this._intentHandlers[a]:null;b.each(f,function(a,b){d._handleComponent(b,a)})}finally{d._finalize()}return d},addIntentHandlers:function(a,c){var d=b.toArray(arguments);c=d.pop(),a=this._checkComponentKey(d.pop()),b.each(c,function(b,c){this.addIntentHandler(a,c,b)},this)},addIntentHandler:function(a,c,d){var e=b.toArray(arguments);d=e.pop(),c=e.pop(),a=this._checkComponentKey(e.pop()),this._intentHandlers||(this._intentHandlers={});var f=this._intentHandlers[c]=this._intentHandlers[c]||{};f[a]=d},removeIntentHandlers:function(a,c){c||(c=a,a=null),b.each(c,function(b,c){this.removeIntentHandler(a,c,b)},this)},removeIntentHandler:function(a,c,d){if(this._intentHandlers){d||(e=c,c=a,a=null);var e=this._intentHandlers[c],f=[];a?b.each(e,function(a,b){d===a&&f.push(b)}):f.push(a),b.each(f,function(a){delete e[a]})}},_checkComponentKey:function(a){return a||b.uniqueId("$$cmp-")}});return e.Intent=a.Class.extend({initialize:function(b,c){this._deferred=a.P.defer(),this._processed=a.P.defer(),this.intentKey=b,this.params=c,this.promise=this._deferred.promise,this.processed=this._processed.promise,this._handlerPromises={},this._dependencies=new d,this._handled=!1},resolve:function(a){return this._handled=!0,this._deferred.resolve(a),this._deferred.promise},reject:function(a){return this._handled=!0,this._deferred.reject(a),this._deferred.promise},then:function(a,b){return this._deferred.promise.then(a,b)},waitFor:function(c){if(!this._componentKey)throw new Error("Component handler is not defined. This method could be called only from an intent handler.");var d=this;return b.each(c,function(a){d._dependencies.setDependency(a)}),d._deferred.promise.then(function(e){return a.P.all(b.map(c,function(b){var c=d._handlerPromises[b];return c||(c=a.P()),c})).then(function(){return e})})},_handleComponent:function(b,c){var d,e=this;try{e._componentKey=b,d=a.P.resolve(c(e))}catch(f){d=a.P.reject(f)}finally{this._handlerPromises[b]=d,delete e._componentKey}},_finalize:function(){var a=this;a._handled||a.reject(new Error("An intent was not handled."));var c=function(){var c=b.keys(a._handlerPromises);return a._dependencies.callDependencies(c,{end:function(b,c){if(c)throw c;return a._handlerPromises[b]}}).then(function(b){return a._processed.resolve(b),b},function(b){throw a._processed.reject(b),b})};return a._deferred.promise.then(c,c)}}),e.handler=function(a){return a.intentHandler=!0,a},e}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(19)],e=function(){"use strict";var a=(c(27),c(1)),b=c(19),d=a.Class.extend({initialize:function(a){this.setOptions(a),this._adapterManager=this.options.adapterManager||new b,this.options.getResourceType&&(this.getResourceType=this.options.getResourceType)},registerView:function(a,b,c){this._adapterManager.registerAdapter(a,b,c)},newView:function(a,b,c){return this._adapterManager.newAdapterInstance(a,b,c)},getResourceType:function(a){return a.type||""}});return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1)],e=function(){var a=c(1),b=c(27),d=a.Class.extend(a.Events.prototype,a.Events,{initialize:function(a){this.setOptions(a),this._children={}},getPath:function(a){for(var b="",c=this;c&&c!=a;)b="/"+c.getKey()+b,c=c.getParent();return b},getParent:function(){return this.parent},getKey:function(){return this.options.key},add:function(a,c){var d=this;return!c&&b.isObject(a)&&(c=a),b.isFunction(a.getKey)&&(a=a.getKey()),d.remove(a),c||(c=d._newChild(a)),c.parent=this,d._children[a]=c,c._notify("add",{}),c},get:function(a,b){var c=this._children[a];if(!c){var d=a.split("/");c=this._getByPath(d,0,b)}return c},getAll:function(){var a=this,c=b.toArray(arguments),d=[];return a._forEach(c,function(a){d.push(a)}),d},getAllKeys:function(){var a=this;return b.keys(a._children)},isParentOf:function(a,b){for(var c=b!==!1?a:a.getParent(),d=!1;c&&!(d=c===this);)c=c.getParent();return d},find:function(a){var b,c=this,d=c.getKey();return a==d?b=c:c._forEach([],function(c){return b=c.find(a),!b}),b},remove:function(a){var b=this,c=b._children[a];return c&&(c._notify("remove",{}),delete b._children[a]),c},visit:function(a){var c=this,d=!0;b.isFunction(a.before)&&(d=a.before(c)!==!1),d&&b.each(c._children,function(b){b.visit(a)}),b.isFunction(a.after)&&a.after(c)},_getByPath:function(a,b,c){var d=b>=0&&b<a.length?a[b]:null;if(d){var e=this._children[d];return!e&&c&&(e=this.add(d)),e&&b<a.length-1?e._getByPath(a,b+1,c):e}},_forEach:function(a,c){function d(a){var b=!1;if(a){var d=c.call(f,a,e);b=d===!1}return e++,b}var e=0,f=this;b.isFunction(a)&&(c=a,a=[]),a&&a.length?b.find(a,function(a){var b=f._children[a];return d(b)}):b.find(f._children,d)},_notify:function(a,b){var c=this;for(b.node=c;c&&(c.triggerMethod(a,b),!b.stopPropagation);)c=c.getParent()},_newChild:function(a){var c=this.getClass();return new c(b.extend({},this.options,{key:a}))}}),e={_status:"inactive",getStatus:function(){return this._status||""},setStatus:function(a,c){var d=this._status,e=d!=a||c&&c.force;return e&&(this._status=a,this._notify("status",b.extend({},c,{prevStatus:d}))),e},setExclusive:function(a){this.options.exclusive=!!a},isExclusive:function(){return"exclusive"==this.options.mode||this.options.exclusive!==!1},isActive:function(){return"active"==this._status},activate:function(a){return this.setStatus("active",a)},deactivate:function(a){return this.setStatus("inactive",a)},toggle:function(a){return this.isActive()?this.deactivate(a):this.activate(a)},getActive:function(){var a=this.getAll();return b.map(a,function(a){return a.isActive()})},getFirstActive:function(){var a=this.getAll();return b.find(a,function(a){return a.isActive()})},getStats:function(){var a=this,b={all:[]};return a._forEach([],function(a){var c=a.getKey();b.all.push(c);var d=a.getStatus(),e=b[d]=b[d]||[];e.push(c)
}),b},onStatus:function(){function a(){return{internal:!0}}function b(b,c){"before"==c?b.activate(a()):"after"==c&&b.deactivate(a())}function c(b,c){"before"==c?b.deactivate(a()):"after"==c&&b.activate(a())}function d(b,c){("before"==c||"after"==c)&&b.deactivate(a())}function e(a,e){var f;if("activateBefore"==a.options.mode?f=b:"activateAfter"==a.options.mode?f=c:a.isExclusive()&&(f=d),f){var g="before",h=function(a){"before"==g&&a.isParentOf(e.node,!0)&&(g="in"),f(a,g),"in"==g&&(g="after")};a._forEach([],h)}}return function(b){var c=this;b.node!=c?b.node.isActive()&&!b.internal&&(e(c,b),c.activate()):!c.isActive()&&c.options.deactivateAll&&c.visit({after:function(b){b.deactivate(a())}})}}()},f=d.extend(e,{initialize:function(a){var b=d.prototype;b.initialize.call(this,a),this.setOptions({deactivateAll:!0})}});return f}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27)],e=function(){var a=c(27);return{getDataSet:function(){return this.props.dataSet},componentWillMount:function(){var a=this.getDataSet();a.on("update:end",this._onUpdate)},componentWillUnmount:function(){var a=this.getDataSet();a.off("update:end",this._onUpdate)},_onUpdate:function(){var a=this;a.setState(a._newState())},getInitialState:function(){return this._newState()},_newState:function(){return{}},renderChildren:function(){var b=this.getDataSet(),c=a.map(b._getIndexEntries(),function(a){return this.renderChild(a)},this);return c}}}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c,c(27),c(1),c(30)],e=function(){var a=(c(1),c(27)),b=c(30);return b.createClass({render:function(){var a=this.state.items||[],c=this._getSize(),d=this._getItemHeight(),e=(this.state.index||0)*d,f=c*d;return b.DOM.div({id:this.props.id,className:this.props.className,style:this.props.style,onScroll:this._onScroll},b.DOM.div({ref:"wrapper",style:{height:f+"px",position:"relative"}},b.DOM.div({ref:"block",style:{top:e+"px",position:"absolute",left:"0px",right:"0px",bottom:"auto"}},a)))},componentWillMount:function(){this._adjustPosition=a.debounce(this._adjustPosition,5),this._setScrollPos=a.debounce(a.bind(this._setScrollPos,this),30)},componentDidMount:function(){this._resetScrollPos(this.props)},componentWillReceiveProps:function(a){this._resetScrollPos(a)},componentDidUpdate:function(){this._adjustPosition()},getInitialState:function(){return this._newState({index:0,length:0,items:[],scrollPos:0})},_newState:function(b){return a.extend({},this.state,b)},_getPageSize:function(){return this.props.pageSize||4},_getSize:function(){return this.props.length||0},_getItemHeight:function(){return this.props.itemHeight||10},_loadItems:function(a){this.props.loadItems(a)},_resetScrollPos:function(a){a=a||this.props;var b=this.state.scrollPos,c=a.focusedIndex;c=isNaN(c)?-1:c;var d=this._getSize();if(!isNaN(c)&&c>=0&&d>c){var e=this._getItemHeight();b=c*e}this._focusedItemIdx=c,this._resetPos=!0,this._setScrollPos(b,!0)},_adjustPosition:function(){if(this.isMounted()){var a=this,b=a.getDOMNode(),c=b.scrollTop,d=a._getItemHeight(),e=c-a.state.index*d,f=a.state.items.length*d,g=a.refs.block.getDOMNode(),h=g.offsetHeight,i=c-h*(e/f);i=Math.round(i),g.style.top=i+"px",isNaN(a._focusedItemIdx)||(delete a._focusedItemIdx,setTimeout(function(){b.scrollTop=a.state.scrollPos},30))}},_setScrollPos:function(a,b){var c=this;if(c.isMounted()){var d=c._getPageSize(),e=c._getItemHeight(),f=c.getDOMNode(),g=f.offsetHeight,h=g/4,i=Math.max(a-h,0),j=a+g+h,k=Math.floor(i/e),l=Math.ceil((j+e-1)/e),m=Math.floor(k/d),n=Math.ceil((l+d-1)/d),o=m*d,p=(n-m)*d,q={scrollPos:a,index:o,length:p};c._resetPos||b||q.index!=c.state.index||q.length!=c.state.length?(q.callback=function(a){q.items=a,c.isMounted()&&c.setState(c._newState(q))},c._loadItems(q),delete c._resetPos):c._adjustPosition()}},_onScroll:function(){this._setScrollPos(this.getDOMNode().scrollTop)}})}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c],e=function(){"use strict";function a(b){this.reset(),"string"==typeof b?this.setURI(b):"object"==typeof b&&a._doCopy(b,this,!0)}function b(a){return a?Array.isArray?Array.isArray(a):"[object Array]"==Object.prototype.toString.call(a):!1}function c(a){return""===a||"."===a||".."===a}function d(a){return a&&""!==a&&"/"===a[a.length-1]?!0:!1}return a.toURI=function(b){return new a(b).toString()},a.parse=function(b){return new a(b)},a.splitQuery=function(a){var c={};if(a&&""!==a)for(var d=a.split("&"),e=0;e<d.length;e++){var f=d[e],g=f.split("="),h=decodeURIComponent(g[0]),i=decodeURIComponent(g[1]);if(h in c){var j=c[h],k=j;b(k)||(k=c[h]=[j]),k.push(i)}else c[h]=i}return c},a.serializeQuery=function(a){var c="";for(var d in a)if(a.hasOwnProperty(d)){var e=a[d]||"",f=encodeURIComponent(d),g=e;b(g)||(g=[e]);for(var h=0;h<g.length;h++){c.length>0&&(c+="&");var i=encodeURIComponent(g[h]);c+=f,c+="=",c+=i}}return c},a.resolvePathSegments=function(a){for(var b=!1,d=a.length,e=c(a[0]),f=c(a[d-1]),g=0;d>g;g++){var h=a[g];c(h)?(b=!1,a.splice(g,1),d--,g--,".."==h&&g>=0&&(a.splice(g,1),d--,g--)):b=!0}return e&&a.splice(0,0,""),f&&(a=a.push("")),b},a._doCopy=function(b,c,d){for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];"object"==typeof f&&d&&(f=a._doCopy(f,{})),c[e]=f}return c},a.prototype.reset=function(a,b){b||(delete this.scheme,delete this.authority,delete this.domain,delete this.port),a||(delete this.path,delete this.query,delete this.fragment)},a.prototype.resetDomain=function(){this.reset(!0)},a.prototype.asJSON=function(a){return JSON.stringify(this,null,a)},a.prototype.newCopy=function(){var b=this.newInstance();return a._doCopy(this,b,!0),b},a.prototype.newInstance=function(){return new a},a.prototype.setURI=function(b){b=b||"",b=b.replace(/[\\]/gi,"/");var c=b.lastIndexOf("#");if(c>=0&&(this.fragment=b.substring(c+1),b=b.substring(0,c)),c=b.indexOf("?"),c>=0){var d=b.substring(c+1);this.query=a.splitQuery(d),b=b.substring(0,c)}var e=!1;if(b.match(/^\/\//)?(b=b.substring("//".length),e=!0):(c=b.indexOf("://"),c>=0&&(this.scheme=b.substring(0,c),b=b.substring(c+"://".length),e=!0)),e){if(c=b.indexOf("/"),c>=0&&(this.path=b.substring(c),b=b.substring(0,c)),c=b.indexOf(":"),c>=0){try{this.port=parseInt(b.substring(c+1))}catch(f){}b=b.substring(0,c)}c=b.indexOf("@"),c>=0&&(this.authority=b.substring(0,c),b=b.substring(0,c)),this.domain=b.toLowerCase()}else this.path=b;return this},a.prototype.resolve=function(b){if("string"==typeof b&&(b=new a(b)),b.domain&&""!==b.domain)return b.newCopy();var c=this.newCopy(),e=b.path;if(0!==e.indexOf("/")){var f=c.path,g=(f.lastIndexOf("/"),f.split(/[\/]/gi)),h=d(f);h||g.pop();for(var i=e.split(/[\/]/gi),j=0;j<i.length;j++){var k=i[j];g.push(k)}{""===g[0],g.length>0&&""===g[g.length-1]}a.resolvePathSegments(g,!0),c.path=g.join("/")}else c.path=e;return c.query=b.query,c.fragment=b.fragment,c},a.prototype.toString=function(){var b="";if(this.scheme&&(b=this.scheme),(this.authority||this.domain)&&(""!==b&&(b+=":"),b+="//"),this.authority&&(b+=this.authority,b+="@"),this.domain&&(b+=this.domain),this.port&&(b+=":"+this.port),""!==this.path&&(b.length>0&&!this.path.match(/^[\/]/)&&(b+="/"),b+=this.path),this.query){var c=this.query;"string"!=typeof c&&(c=a.serializeQuery(c)),b+="?"+c}return this.fragment&&(b+="#"+this.fragment),b},a}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d},function(a){a.exports=e},function(a,b,c){var d,e;d=[c(27),c(29),c(32)],e=function(a,b){var c=b.Class.extend({includes:b.Mixin.Events,options:{resolution:4,pointerCursor:!0},initialize:function(a){b.setOptions(this,a)},onAdd:function(a){this._map=a,this._container=this._map._container,a.on("mousemove",this._move,this)},onRemove:function(){var a=this._map;a.off("click",this._click,this),a.off("mousemove",this._move,this),this._removeMouseCursorStyle()},_click:function(a){var b=this._objectForEvent(a);b.data&&this.fire("click",b)},_move:function(a){var b=this._objectForEvent(a);b.data!==this._mouseOn?(this._mouseOn&&(this.fire("mouseout",{latlng:a.latlng,data:this._mouseOn}),this._removeMouseCursorStyle()),b.data&&(this.fire("mouseover",b),this._setMouseCursorStyle()),this._mouseOn=b.data):b.data&&this.fire("mousemove",b)},_setMouseCursorStyle:function(){this.options.pointerCursor&&(this._container._pointerCursorCount?this._container._pointerCursorCount++:(this._container._pointerCursorCount=1,this._container.style.cursor="pointer"))},_removeMouseCursorStyle:function(){this.options.pointerCursor&&this._container._pointerCursorCount&&(this._container._pointerCursorCount--,0===this._container._pointerCursorCount&&(this._container.style.cursor="",delete this._container._pointerCursorCount))},_objectForEvent:function(){throw new Error("This method should be implemented in subclasses.")}});return c}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(27),c(29),c(1)],e=function(a,b){return b.Class.extend({includes:b.Mixin.Events,initialize:function(c){b.setOptions(this,c),a.defaults(this.options,{minZoom:0,maxZoom:25,tileSize:256})},onAdd:function(a){this._map=a,this._container=this._map._container,this._update()},onRemove:function(){},_update:function(){{var a=this._map.getZoom();this.options.tileSize}if(!(a>this.options.maxZoom||a<this.options.minZoom)){var b=this._map.getPixelBounds(),c=this._getTilePosition(b.min),d=this._getTilePosition(b.max),e=this._getTilesReferencesFromCenterOut(c,d),f={queue:e},g=this;g.fire("startLoading",f),g.options.loadTiles(a,e,function(a,b){a&&(f.errors=a),f.tiles=b,g.fire("endLoading",f)}),this.options.loadTiles=function(a,b,c){c(new Error("Not implemented"))}}},_getTilesReferencesFromCenterOut:function(a,b){for(var c=[],d=a.y;d<=b.y;d++)for(var e=a.x;e<=b.x;e++)c.push(this._newPoint(e,d));if(c.length){var f=this,g=this._newPoint((a.x+b.x)/2,(a.y+b.y)/2);c.sort(function(a,b){var c=f._distance(a,g)-f._distance(b,g);return c})}return c},_newPoint:function(a,b){return a.length&&(b=a[1],a=a[0]),{x:a,y:b,toString:function(){return JSON.stringify(this,null,2)}}},_distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},_getTilePosition:function(a){var b=this.options.tileSize;return this._newPoint(Math.floor(a.x/b),Math.floor(a.y/b))}})}.apply(null,d),!(void 0!==e&&(a.exports=e))}])});